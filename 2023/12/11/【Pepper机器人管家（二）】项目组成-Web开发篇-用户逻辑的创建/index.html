<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>【Pepper机器人管家（二）】项目组成-Web开发篇：后端 | Luca's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script src="https://www.googletagmanager.com/gtag/js?id=G-N9YN4E82GT" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-N9YN4E82GT');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement('script');
  hm.src = 'https://hm.baidu.com/hm.js?' + 'c568d4df2cf5d283c6c34b3394e7c0f9';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><div class="darkmode-toggle">🌓</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">【Pepper机器人管家（二）】项目组成-Web开发篇：后端</h1><a id="logo" href="/.">Luca's Blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/tags/"><i class="fa fa-tags"> 标签</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">【Pepper机器人管家（二）】项目组成-Web开发篇：后端</h1><div class="post-meta">2023-12-11<span> | </span><span class="category"><a href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="clear"></div><div class="post-content"><h1 id="项目概述"><a href="#项目概述" class="headerlink" title="项目概述"></a>项目概述</h1><p>Web模块的大致结构是基于MVC架构的flask+jinja2+mysql的前后端不分离的结构，大致结构已经在上篇中介绍了，这里不做赘述了。由于项目需求比较简单而且需求特殊，后端选择自己构建导致有些用法并不完全满足falsk的开发规范。前端没有使用框架，而是使用开源项目二次开发，代码中有许多冗余。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">│  README.md</span><br><span class="line">│  .env //环境变量</span><br><span class="line">│  app.log //运行日志</span><br><span class="line">│  runserver.py //项目启动文件</span><br><span class="line">│  requirements.txt //项目依赖</span><br><span class="line">├─app</span><br><span class="line">│  │  config.py //配置文件,数据库连接(需要在环境变量中加入此路径)</span><br><span class="line">│  │  forms.py //验证表单程序</span><br><span class="line">│  │  __init__.py //模块初始化文件，Flask 程序对象的创建须在 __init__.py 文件里完成</span><br><span class="line">│  │  wsgi.py //wsgi服务启动</span><br><span class="line">│  │</span><br><span class="line">│  ├─controller //MVC中的控制器(C)</span><br><span class="line">│  │     event_controller.py //事件控制器</span><br><span class="line">│  │     api_controller.py //api控制器</span><br><span class="line">│  │     user_controller.py //用户控制器</span><br><span class="line">│  │     reminder_controller.py //提醒控制器</span><br><span class="line">│  │  </span><br><span class="line">│  ├─model //MVC中的模型,数据库中的表(M)</span><br><span class="line">│  │     Event.py //事件表</span><br><span class="line">│  │     User.py //用户表</span><br><span class="line">│  │     EmailHistory //邮件历史记录</span><br><span class="line">│  │</span><br><span class="line">│  ├─views //MVC中的视图(V)</span><br><span class="line">│  │     admin_view.py //管理员</span><br><span class="line">│  │     event_view.py //事件</span><br><span class="line">│  │     index_view.py //主页</span><br><span class="line">│  │     user_view.py //用户</span><br><span class="line">│  │     album_view.py //相册</span><br><span class="line">│  │     reminder_view.py//提醒</span><br><span class="line">│  │ </span><br><span class="line">│  ├─static //静态资源，css，js等</span><br><span class="line">│  ├─templates //视图映射的页面</span><br><span class="line">│  │      index.html //主页</span><br><span class="line">│  │      create_event.html //创建事件</span><br><span class="line">│  │      edit_event.html //编辑事件</span><br><span class="line">│  │      event_list.html //查看事件</span><br><span class="line">│  │      login.html //登录</span><br><span class="line">│  │      register.html //注册</span><br><span class="line">│  │      calendar.html</span><br><span class="line">│  │      profile.html</span><br><span class="line">│  │      album.html</span><br><span class="line">│  │      email_history.html</span><br><span class="line">│  │      email_template.html</span><br></pre></td></tr></table></figure>

<h2 id="模型-数据库的构建"><a href="#模型-数据库的构建" class="headerlink" title="模型-数据库的构建"></a>模型-数据库的构建</h2><p>项目开始项目构建数据库,也是MVC中的模型。数据库的搭建使用了flask-SQLAlchemy的orm框架，使用flask-migrate进行数据库的迁移。</p>
<p><strong>User.py:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> db</span><br><span class="line"><span class="keyword">from</span> werkzeug.security <span class="keyword">import</span> generate_password_hash, check_password_hash</span><br><span class="line"><span class="keyword">from</span> flask_login <span class="keyword">import</span> UserMixin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(db.Model, UserMixin):</span><br><span class="line">    __tablename__ = <span class="string">&#x27;users&#x27;</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    email = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>, unique=<span class="literal">True</span>)</span><br><span class="line">    phone = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    password_hash = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>)  <span class="comment"># 添加密码哈希字段</span></span><br><span class="line">    is_admin = db.Column(db.Boolean, default=<span class="literal">False</span>, nullable=<span class="literal">False</span>)  <span class="comment"># 新增 is_admin 字段</span></span><br><span class="line"></span><br><span class="line">    event = db.relationship(<span class="string">&#x27;Event&#x27;</span>, backref=<span class="string">&#x27;user&#x27;</span>, lazy=<span class="string">&#x27;dynamic&#x27;</span>)</span><br><span class="line">    email_history = db.relationship(<span class="string">&#x27;EmailHistory&#x27;</span>, backref=<span class="string">&#x27;user&#x27;</span>, lazy=<span class="string">&#x27;dynamic&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, email, phone, password, is_admin=<span class="literal">False</span></span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.email = email</span><br><span class="line">        self.phone = phone</span><br><span class="line">        self.set_password(password)  <span class="comment"># 在初始化时设置密码哈希值</span></span><br><span class="line">        self.is_admin = is_admin  <span class="comment"># 设置用户是否是管理员</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;User %r&gt;&#x27;</span> % self.name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加密码哈希相关的方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_password</span>(<span class="params">self, password</span>):</span><br><span class="line">        self.password_hash = generate_password_hash(password)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_password</span>(<span class="params">self, password</span>):</span><br><span class="line">        <span class="keyword">return</span> check_password_hash(self.password_hash, password)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 实现 is_active 方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_active</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>  <span class="comment"># 返回 True 表示用户是活动的，可以登录</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>Event.py:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> db</span><br><span class="line"><span class="keyword">from</span> app.model.User <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.hybrid <span class="keyword">import</span> hybrid_property</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Event</span>(db.Model):</span><br><span class="line">    __tablename__ = <span class="string">&#x27;events&#x27;</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    user_id = db.Column(db.Integer, db.ForeignKey(User.<span class="built_in">id</span>, ondelete=<span class="string">&#x27;CASCADE&#x27;</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    title = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    start_date = db.Column(db.Date, nullable=<span class="literal">False</span>)</span><br><span class="line">    event_time = db.Column(db.Time)</span><br><span class="line">    end_date = db.Column(db.Date)</span><br><span class="line">    location = db.Column(db.String(<span class="number">255</span>))</span><br><span class="line">    description = db.Column(db.String(<span class="number">255</span>))</span><br><span class="line">    repeat = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>, default=<span class="string">&quot;none&quot;</span>)  <span class="comment"># Text field for custom repeat types</span></span><br><span class="line">    reminder_type = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>, default=<span class="string">&quot;none&quot;</span>)</span><br><span class="line">    reminder_time = db.Column(db.Float, nullable=<span class="literal">True</span>, default=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @hybrid_property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">duration</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.end_date - self.start_date</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, user_id, title, start_date, event_time, end_date, location, description, reminder_time,</span></span><br><span class="line"><span class="params">                 repeat, reminder_type</span>):</span><br><span class="line">        self.user_id = user_id</span><br><span class="line">        self.title = title</span><br><span class="line">        self.start_date = start_date</span><br><span class="line">        self.event_time = event_time</span><br><span class="line">        self.end_date = end_date</span><br><span class="line">        self.location = location</span><br><span class="line">        self.description = description</span><br><span class="line">        self.repeat = repeat</span><br><span class="line">        self.reminder_type = reminder_type</span><br><span class="line">        self.reminder_time = reminder_time</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;Event %r&gt;&#x27;</span> % self.title</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>EmailHistory.py:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding:utf-8  </span></span><br><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> db</span><br><span class="line"><span class="keyword">from</span> app.model.User <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmailHistory</span>(db.Model):</span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    user_id = db.Column(db.Integer, db.ForeignKey(User.<span class="built_in">id</span>, ondelete=<span class="string">&#x27;CASCADE&#x27;</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    title = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    content = db.Column(db.Text, nullable=<span class="literal">False</span>)</span><br><span class="line">    recipients = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    sent_at = db.Column(db.DateTime, default=datetime.utcnow, nullable=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, user_id, title, content, recipients</span>):</span><br><span class="line">        self.user_id = user_id</span><br><span class="line">        self.title = title</span><br><span class="line">        self.content = content</span><br><span class="line">        self.recipients = recipients</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>创建好SQLAlchemy后使用flask-Migrate命令初始化数据库，使用数据库迁移可以很好的管理数据库结构的改变而且不会影响数据。</p>
<h3 id="数据库迁移"><a href="#数据库迁移" class="headerlink" title="数据库迁移"></a><strong>数据库迁移</strong></h3><p>创建迁移存储库：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flask db init</span><br></pre></td></tr></table></figure>

<p>这会将迁移文件夹添加到应用程序中。此时，你可以发现项目目录多了一个 migrations 的文件夹，下边的 versions 目录下的文件就是生成的数据库迁移文件！</p>
<p>然后，运行以下命令生成迁移</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flask db migrate -m <span class="string">&quot;initial migration&quot;</span></span><br></pre></td></tr></table></figure>

<p>做完这两步就完成了第一次的初始迁移操作，我们可以看数据库已经有了我们创建的模型字段！之后，每次在新增和修改完模型数据之后，只需要执行以下两个命令即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flask db migrate -m <span class="string">&quot;description of changes&quot;</span></span><br><span class="line">flask db upgrade</span><br></pre></td></tr></table></figure>

<p>这些步骤将允许你使用<code>flask_migrate</code>管理数据库模型的变化。请确保按照这些步骤在你的Flask应用中设置并使用<code>flask_migrate</code>，以便维护数据库模型的一致性。</p>
<p>使用Navicate查看数据模型：</p>
<p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/202312112210753.png" alt="image.png"></p>
<h2 id="以登录为例创建Web-App"><a href="#以登录为例创建Web-App" class="headerlink" title="以登录为例创建Web App"></a>以登录为例创建Web App</h2><h3 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a><strong>控制器</strong></h3><p>用户管理使用了flask-login管理用户逻辑<br>我们首先编写注册和登录逻辑，创建<code>app/controller/user_controller.py</code> 。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> flash, redirect, url_for, render_template, make_response</span><br><span class="line"><span class="keyword">from</span> flask_login <span class="keyword">import</span> login_user, login_required, logout_user, current_user</span><br><span class="line"><span class="keyword">from</span> app.forms <span class="keyword">import</span> RegisterForm, LoginForm</span><br><span class="line"><span class="keyword">from</span> app.model.User <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> db, login_manager</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    注册新用户。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    该函数处理新用户的注册过程。它验证用户提交的表单数据，</span></span><br><span class="line"><span class="string">    检查用户是否已存在，在数据库中创建新用户，并将用户重定向到登录页面</span></span><br><span class="line"><span class="string">    注册成功后。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        如果表单数据有效并且用户注册成功，则将用户重定向到登录页面。</span></span><br><span class="line"><span class="string">        否则，它会呈现带有注册表单的 register.html 模板。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    form = RegisterForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        <span class="comment"># 获取用户提交的数据</span></span><br><span class="line">        name = form.name.data</span><br><span class="line">        email = form.email.data</span><br><span class="line">        phone = form.phone.data</span><br><span class="line">        password = form.password.data</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查用户是否已存在</span></span><br><span class="line">        existing_user = User.query.filter_by(email=email).first()</span><br><span class="line">        <span class="keyword">if</span> existing_user:</span><br><span class="line">            flash(<span class="string">&#x27;该邮箱地址已被注册&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;user.register&#x27;</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 创建新用户</span></span><br><span class="line">        new_user = User(name=name, email=email, phone=phone, password=password)</span><br><span class="line">        db.session.add(new_user)</span><br><span class="line">        db.session.commit()</span><br><span class="line"></span><br><span class="line">        flash(<span class="string">&#x27;注册成功，请登录&#x27;</span>, <span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;user.login&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, form=form)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    用户登录函数</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    如果用户已登录，则重定向到受保护的页面。</span></span><br><span class="line"><span class="string">    如果用户提交了有效的登录表单，则验证用户凭据并将用户标记为已登录。</span></span><br><span class="line"><span class="string">    如果用户验证失败，则显示错误消息。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    return: 渲染登录页面或重定向到受保护的页面</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> current_user.is_authenticated:</span><br><span class="line">        <span class="comment"># 如果用户已登录，重定向到受保护的页面</span></span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;event.show_event&#x27;</span>))</span><br><span class="line">    form = LoginForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        email = form.email.data  <span class="comment"># 修改为使用邮箱作为登录凭据</span></span><br><span class="line">        password = form.password.data</span><br><span class="line">        user = User.query.filter_by(email=email).first()</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">and</span> user.check_password(password):</span><br><span class="line">            <span class="comment"># 用户验证成功，将用户标记为已登录</span></span><br><span class="line">            <span class="comment"># 可以使用 Flask-Login 或自己的会话管理逻辑来处理登录状态</span></span><br><span class="line">            login_user(user, remember=form.remember)</span><br><span class="line">            <span class="comment"># return redirect(url_for(&#x27;event.show_event&#x27;))  # 跳转到用户仪表板或其他受保护的页面</span></span><br><span class="line">            <span class="comment"># 设置cookie</span></span><br><span class="line">            response = make_response(redirect(url_for(<span class="string">&#x27;event.show_event&#x27;</span>)))</span><br><span class="line">            response.set_cookie(<span class="string">&#x27;user_id&#x27;</span>, <span class="built_in">str</span>(user.<span class="built_in">id</span>))  <span class="comment"># 存储用户ID在cookie中</span></span><br><span class="line">            flash(<span class="string">&#x27;登录成功&#x27;</span>, <span class="string">&#x27;success&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flash(<span class="string">&#x27;登录失败，请检查邮箱或密码&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, form=form)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">profile</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    用户个人信息页面</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    name = current_user.name</span><br><span class="line">    email = current_user.email</span><br><span class="line">    phone = current_user.phone</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;profile.html&#x27;</span>, name=name, email=email, phone=phone)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    logout_user()  <span class="comment"># 使用 Flask-Login 注销用户</span></span><br><span class="line">    flash(<span class="string">&#x27;成功注销&#x27;</span>, <span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;user.login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_manager.user_loader</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_user</span>(<span class="params">user_id</span>):</span><br><span class="line">    <span class="comment"># 使用用户 ID 查询用户对象</span></span><br><span class="line">    <span class="keyword">return</span> User.query.get(<span class="built_in">int</span>(user_id))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>创建表单验证:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># forms.py  </span></span><br><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> FlaskForm  </span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> StringField, PasswordField, validators, SubmitField, ValidationError, DateField, TimeField  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RegisterForm</span>(<span class="title class_ inherited__">FlaskForm</span>):  </span><br><span class="line">	name = StringField(<span class="string">&#x27;用户名&#x27;</span>, [validators.DataRequired(<span class="string">&quot;用户名不能为空&quot;</span>)])  </span><br><span class="line">	email = StringField(<span class="string">&#x27;邮箱&#x27;</span>, [validators.DataRequired(<span class="string">&quot;邮箱不能为空&quot;</span>), validators.Email(<span class="string">&quot;无效的邮箱地址&quot;</span>)])  </span><br><span class="line">	phone = StringField(<span class="string">&#x27;电话&#x27;</span>)  </span><br><span class="line">	password = PasswordField(<span class="string">&#x27;密码&#x27;</span>, [  </span><br><span class="line">	validators.DataRequired(<span class="string">&quot;密码不能为空&quot;</span>),  </span><br><span class="line">	validators.Length(<span class="built_in">min</span>=<span class="number">8</span>, message=<span class="string">&quot;密码长度至少 8 个字符&quot;</span>)  </span><br><span class="line">	])  </span><br><span class="line">	confirm_password = PasswordField(<span class="string">&#x27;确认密码&#x27;</span>, [  </span><br><span class="line">	validators.DataRequired(<span class="string">&quot;请再次输入密码&quot;</span>),  </span><br><span class="line">	validators.EqualTo(<span class="string">&#x27;password&#x27;</span>, message=<span class="string">&#x27;两次密码不匹配&#x27;</span>)  </span><br><span class="line">	])  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginForm</span>(<span class="title class_ inherited__">FlaskForm</span>):  </span><br><span class="line">	email = StringField(<span class="string">&#x27;邮箱&#x27;</span>, [validators.DataRequired(<span class="string">&quot;邮箱不能为空&quot;</span>), validators.Email(<span class="string">&quot;无效的邮箱地址&quot;</span>)])  </span><br><span class="line">	password = PasswordField(<span class="string">&#x27;密码&#x27;</span>, [validators.DataRequired(<span class="string">&quot;密码不能为空&quot;</span>)])  </span><br><span class="line">	remember = StringField(<span class="string">&#x27;记住我&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a><strong>视图</strong></h3><p>项目使用flask Blueprint(蓝图)来管理路由,创建<code>app/views/user_view.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># user_view.py  </span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint  </span><br><span class="line"><span class="keyword">from</span> app.controller <span class="keyword">import</span> user_controller  </span><br><span class="line">  </span><br><span class="line">user_blueprint = Blueprint(<span class="string">&#x27;user&#x27;</span>, __name__)  </span><br><span class="line">  </span><br><span class="line">user_blueprint.route(<span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>])(user_controller.register)  </span><br><span class="line">user_blueprint.route(<span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>])(user_controller.login)  </span><br><span class="line">user_blueprint.route(<span class="string">&#x27;/logout&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>])(user_controller.logout)  </span><br><span class="line">user_blueprint.route(<span class="string">&#x27;/profile&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>])(user_controller.profile)</span><br></pre></td></tr></table></figure>

<h3 id="将参数通过jinja2传递到前端"><a href="#将参数通过jinja2传递到前端" class="headerlink" title="将参数通过jinja2传递到前端"></a>将参数通过jinja2传递到前端</h3><p><strong>注册页面:</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">title</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../static/css/register-login.css&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../static/images/robot.png&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/x-icon&quot;</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;cent-box register-box&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;cent-box-header&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;main-title hide&quot;</span>&gt;</span>Pepper机器人<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;sub-title&quot;</span>&gt;</span>日程管理系统<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;cont-main clearfix&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index-tab&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index-slide-nav&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;user.login&#x27;) &#125;&#125;&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;user.register&#x27;) &#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;active&quot;</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;slide-bar slide-bar1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span>  </span><br><span class="line">&#123;&#123; form.hidden_tag() &#125;&#125;  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login form&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;group&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;group-ipt name&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span>  </span><br><span class="line">&#123;% if form.name.data is not none %&#125;  </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; form.name.data &#125;&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入您的用户名&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line">&#123;% else %&#125;  </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入您的用户名&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line">&#123;% endif %&#125;  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;group-ipt email&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span>  </span><br><span class="line">&#123;% if form.email.data is not none %&#125;  </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">id</span>=<span class="string">&quot;email&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; form.email.data &#125;&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入您的邮箱&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line">&#123;% else %&#125;  </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">id</span>=<span class="string">&quot;email&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入您的邮箱&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line">&#123;% endif %&#125;  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;group-ipt phone&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;phone&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span>  </span><br><span class="line">&#123;% if form.phone.data is not none %&#125;  </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">id</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; form.phone.data &#125;&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入您的电话&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line">&#123;% else %&#125;  </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">id</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入您的电话&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line">&#123;% endif %&#125;  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;group-ipt password&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入密码&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;group-ipt confirm_password&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;confirm_password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;confirm_password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;confirm_password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;确认密码&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;register-btn&quot;</span> <span class="attr">id</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;注册&quot;</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;../static/js/particles.js&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;../static/js/background.js&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;../static/js/jquery.min.js&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;../static/js/layer/layer.js&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;../static/js/index.js&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果图:<br><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/202312112239677.png" alt="image.png"></p>
<p><strong>登录页面:</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;css/register-login.css&#x27;) &#125;&#125;&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;images/robot.png&#x27;) &#125;&#125;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/x-icon&quot;</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;cent-box&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;cent-box-header&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;main-title hide&quot;</span>&gt;</span>Pepper机器人<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;sub-title&quot;</span>&gt;</span>日程管理系统<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;cont-main clearfix&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index-tab&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index-slide-nav&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;user.login&#x27;) &#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;active&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;user.register&#x27;) &#125;&#125;&quot;</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;slide-bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span>  </span><br><span class="line">&#123;&#123; form.hidden_tag() &#125;&#125;  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login form&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;group&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;group-ipt email&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span>  </span><br><span class="line">&#123;% if form.email.data is not none %&#125;  </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">id</span>=<span class="string">&quot;email&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; form.email.data &#125;&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入您的邮箱&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line">&#123;% else %&#125;  </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">id</span>=<span class="string">&quot;email&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入您的邮箱&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line">&#123;% endif %&#125;  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;group-ipt password&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入您的登录密码&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;login-btn register-btn&quot;</span> <span class="attr">id</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;remember clearfix&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;remember-me&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;remember&quot;</span>&gt;</span> 记住我<span class="tag">&lt;/<span class="name">label</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;../static/js/particles.js&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;../static/js/background.js&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;../static/js/jquery.min.js&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;../static/js/layer/layer.js&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;../static/js/index.js&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果图:</p>
<p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/202312112239068.png" alt="image.png"></p>
<h3 id="配置config-py"><a href="#配置config-py" class="headerlink" title="配置config.py"></a>配置config.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 调试模式是否开启  </span></span><br><span class="line">DEBUG = <span class="literal">True</span>  </span><br><span class="line"><span class="comment"># 是否追踪对象的修改。  </span></span><br><span class="line">SQLALCHEMY_TRACK_MODIFICATIONS = <span class="literal">True</span>  </span><br><span class="line"><span class="comment"># 查询时显示原始SQL语句  </span></span><br><span class="line">SQLALCHEMY_ECHO = <span class="literal">False</span>  </span><br><span class="line"><span class="comment"># session必须要设置key  </span></span><br><span class="line">SECRET_KEY = <span class="string">&#x27;c798ee1f5fd894f6e0ba9fc0d16b8b22&#x27;</span>  </span><br><span class="line"><span class="comment"># mysql数据库连接信息  </span></span><br><span class="line">DATABASE = <span class="string">&#x27;schedule&#x27;</span>  </span><br><span class="line">SQLALCHEMY_DATABASE_URI = <span class="string">&quot;mysql+pymysql://[user]:[password]@localhost/&quot;</span> + DATABASE</span><br></pre></td></tr></table></figure>

<h3 id="使用工厂函数初始化"><a href="#使用工厂函数初始化" class="headerlink" title="使用工厂函数初始化"></a>使用工厂函数初始化</h3><p><code>app/_init_.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask  </span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy  </span><br><span class="line"><span class="keyword">from</span> flask_login <span class="keyword">import</span> LoginManager  </span><br><span class="line"><span class="keyword">from</span> flask_migrate <span class="keyword">import</span> Migrate  </span><br><span class="line"><span class="keyword">from</span> flask_restful <span class="keyword">import</span> Api  </span><br><span class="line"><span class="keyword">from</span> flask_admin <span class="keyword">import</span> Admin  </span><br><span class="line"><span class="keyword">from</span> flask_mail <span class="keyword">import</span> Mail  </span><br><span class="line"><span class="keyword">from</span> flask_uploads <span class="keyword">import</span> configure_uploads  </span><br><span class="line"><span class="keyword">import</span> logging  </span><br><span class="line"><span class="keyword">from</span> logging.handlers <span class="keyword">import</span> RotatingFileHandler  </span><br><span class="line"><span class="keyword">from</span> flask_apscheduler <span class="keyword">import</span> APScheduler  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 创建Flask应用实例  </span></span><br><span class="line">db = SQLAlchemy() <span class="comment"># 数据库实例  </span></span><br><span class="line">login_manager = LoginManager() <span class="comment"># 登录管理实例  </span></span><br><span class="line">migrate = Migrate() <span class="comment"># 数据库迁移实例   </span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_app</span>() -&gt; Flask:  </span><br><span class="line"><span class="string">&quot;&quot;&quot;创建Flask应用实例并进行初始化设置。  </span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">Returns:  </span></span><br><span class="line"><span class="string">Flask: 初始化设置后的Flask应用实例。  </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>  </span><br><span class="line">	app = Flask(__name__)  </span><br><span class="line">	app.config.from_object(<span class="string">&#x27;app.config&#x27;</span>)  </span><br><span class="line">	app.config.from_envvar(<span class="string">&#x27;FLASKR_CONFIGS&#x27;</span>)  </span><br><span class="line">	  </span><br><span class="line">	configure_logging(app) <span class="comment"># 添加日志配置  </span></span><br><span class="line">	initialize_extensions(app) <span class="comment"># 初始化  </span></span><br><span class="line">	register_blueprints(app) <span class="comment"># 注册蓝图  </span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> app  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initialize_extensions</span>(<span class="params">app: Flask</span>) -&gt; <span class="literal">None</span>:  </span><br><span class="line"><span class="string">&quot;&quot;&quot;初始化扩展，包括数据库、登录管理、数据库迁移、邮件和文件上传。  </span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">Args:  </span></span><br><span class="line"><span class="string">app (Flask): Flask应用实例。  </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>  </span><br><span class="line">	db.init_app(app)  </span><br><span class="line">	migrate.init_app(app, db)  </span><br><span class="line">	login_manager.init_app(app)  </span><br><span class="line">	login_manager.login_view = <span class="string">&#x27;user.login&#x27;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register_blueprints</span>(<span class="params">app: Flask</span>) -&gt; <span class="literal">None</span>:  </span><br><span class="line"><span class="string">&quot;&quot;&quot;注册蓝图，包括主页、用户、事件和提醒蓝图。  </span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">Args:  </span></span><br><span class="line"><span class="string">app (Flask): Flask应用实例。  </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>   </span><br><span class="line">	<span class="keyword">from</span> app.views.user_view <span class="keyword">import</span> user_blueprint  </span><br><span class="line">	</span><br><span class="line">	app.register_blueprint(user_blueprint, url_prefix=<span class="string">&#x27;/user&#x27;</span>)  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">configure_logging</span>(<span class="params">app: Flask</span>) -&gt; <span class="literal">None</span>:  </span><br><span class="line"><span class="string">&quot;&quot;&quot;配置应用程序日志。  </span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">Args:  </span></span><br><span class="line"><span class="string">app (Flask): Flask应用实例。  </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>  </span><br><span class="line">	log_file_path = <span class="string">&#x27;app.log&#x27;</span>  </span><br><span class="line">	log_handler = RotatingFileHandler(log_file_path, maxBytes=<span class="number">10240</span>, backupCount=<span class="number">10</span>)  </span><br><span class="line">	log_handler.setFormatter(logging.Formatter(  </span><br><span class="line">	<span class="string">&#x27;%(asctime)s %(levelname)s: %(message)s &#x27;</span>  </span><br><span class="line">	<span class="string">&#x27;[in %(pathname)s:%(lineno)d]&#x27;</span>  </span><br><span class="line">	))  </span><br><span class="line">	log_handler.setLevel(logging.INFO)  </span><br><span class="line">	app.logger.addHandler(log_handler)  </span><br><span class="line">  </span><br></pre></td></tr></table></figure>

<h3 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h3><p><code>app/runserver.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> create_app  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">	app = create_app()  </span><br><span class="line">	app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
</div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/choregraphe/" rel="tag">choregraphe</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pepper/" rel="tag">pepper</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li></ul></div><div class="post-nav"><a class="pre" href="/2023/12/12/%E3%80%90Pepper%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%AE%A1%E5%AE%B6%EF%BC%88%E4%B8%89%EF%BC%89%E3%80%91%E9%A1%B9%E7%9B%AE%E7%BB%84%E6%88%90-Web%E5%BC%80%E5%8F%91%E7%AF%87-%E6%97%A5%E7%A8%8B%E9%80%BB%E8%BE%91%E7%9A%84%E5%88%9B%E5%BB%BA/">【Pepper机器人管家（三）】项目组成-Web开发篇-日程逻辑的创建</a><a class="next" href="/2023/12/11/%E3%80%90Pepper%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%AE%A1%E5%AE%B6%EF%BC%88%E4%B8%80%EF%BC%89%E3%80%91%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA/">【Pepper机器人管家（一）】项目构建</a></div><div id="container"></div><link rel="stylesheet" type="text/css" href="//unpkg.com/gitalk/dist/gitalk.css"><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script><script type="text/javascript" src="//unpkg.com/gitalk/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
  clientID: '7712838cc608b3327b6c',
  clientSecret: '63b48a188b96620338ea457323f367b57218c0c0',
  repo: 'blog_comments',
  owner: 'Lucawell',
  admin: ['Lucawell'],
  id: md5(location.pathname),
  distractionFreeMode: false
})
gitalk.render('container')
</script></div></div></div><script type="text/javascript" src="/js/toc.js?v=1.0.0" async></script><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar-toc"><div class="stoc-article" id="sidebar-stoc"><strong class="stoc-title"><i class="fa fa-blind"> Contents </i></strong><div class="toc-nav" id="stoc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">项目概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%9E%84%E5%BB%BA"><span class="toc-number">1.1.</span> <span class="toc-text">模型-数据库的构建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB"><span class="toc-number">1.1.1.</span> <span class="toc-text">数据库迁移</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A5%E7%99%BB%E5%BD%95%E4%B8%BA%E4%BE%8B%E5%88%9B%E5%BB%BAWeb-App"><span class="toc-number">1.2.</span> <span class="toc-text">以登录为例创建Web App</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-number">1.2.1.</span> <span class="toc-text">控制器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-number">1.2.2.</span> <span class="toc-text">视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%8F%82%E6%95%B0%E9%80%9A%E8%BF%87jinja2%E4%BC%A0%E9%80%92%E5%88%B0%E5%89%8D%E7%AB%AF"><span class="toc-number">1.2.3.</span> <span class="toc-text">将参数通过jinja2传递到前端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEconfig-py"><span class="toc-number">1.2.4.</span> <span class="toc-text">配置config.py</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%8E%82%E5%87%BD%E6%95%B0%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.2.5.</span> <span class="toc-text">使用工厂函数初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.2.6.</span> <span class="toc-text">运行项目</span></a></li></ol></li></ol></li></ol></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2023 <a href="/." rel="nofollow">Luca's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>