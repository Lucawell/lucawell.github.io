<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>【Pepper机器人管家（三）】项目组成-Web开发篇-日程逻辑的创建</title>
      <link href="/2023/12/12/%E3%80%90Pepper%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%AE%A1%E5%AE%B6%EF%BC%88%E4%B8%89%EF%BC%89%E3%80%91%E9%A1%B9%E7%9B%AE%E7%BB%84%E6%88%90-Web%E5%BC%80%E5%8F%91%E7%AF%87-%E6%97%A5%E7%A8%8B%E9%80%BB%E8%BE%91%E7%9A%84%E5%88%9B%E5%BB%BA/"/>
      <url>/2023/12/12/%E3%80%90Pepper%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%AE%A1%E5%AE%B6%EF%BC%88%E4%B8%89%EF%BC%89%E3%80%91%E9%A1%B9%E7%9B%AE%E7%BB%84%E6%88%90-Web%E5%BC%80%E5%8F%91%E7%AF%87-%E6%97%A5%E7%A8%8B%E9%80%BB%E8%BE%91%E7%9A%84%E5%88%9B%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>上篇已经以用户注册登录为例创建了一个完整的demo，这篇继续在原有的基础上添加日程管理模块的代码，这也是整个项目中最核心的代码。</p><h1 id="日程管理的实现"><a href="#日程管理的实现" class="headerlink" title="日程管理的实现"></a>日程管理的实现</h1><p>按照MVC的模式一般是:模型–&gt;视图–&gt;控制器的顺序<br><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/202312122007966.png" alt="image.png"></p><h2 id="创建模型"><a href="#创建模型" class="headerlink" title="创建模型"></a>创建模型</h2><p>模型的创建其实在上篇中已经完成:</p><p><strong>Event.py:</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> db</span><br><span class="line"><span class="keyword">from</span> app.model.User <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.hybrid <span class="keyword">import</span> hybrid_property</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Event</span>(db.Model):</span><br><span class="line">    __tablename__ = <span class="string">&#x27;events&#x27;</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    user_id = db.Column(db.Integer, db.ForeignKey(User.<span class="built_in">id</span>, ondelete=<span class="string">&#x27;CASCADE&#x27;</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    title = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    start_date = db.Column(db.Date, nullable=<span class="literal">False</span>)</span><br><span class="line">    event_time = db.Column(db.Time)</span><br><span class="line">    end_date = db.Column(db.Date)</span><br><span class="line">    location = db.Column(db.String(<span class="number">255</span>))</span><br><span class="line">    description = db.Column(db.String(<span class="number">255</span>))</span><br><span class="line">    repeat = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>, default=<span class="string">&quot;none&quot;</span>)  <span class="comment"># Text field for custom repeat types</span></span><br><span class="line">    reminder_type = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>, default=<span class="string">&quot;none&quot;</span>)</span><br><span class="line">    reminder_time = db.Column(db.Float, nullable=<span class="literal">True</span>, default=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @hybrid_property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">duration</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.end_date - self.start_date</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, user_id, title, start_date, event_time, end_date, location, description, reminder_time,</span></span><br><span class="line"><span class="params">                 repeat, reminder_type</span>):</span><br><span class="line">        self.user_id = user_id</span><br><span class="line">        self.title = title</span><br><span class="line">        self.start_date = start_date</span><br><span class="line">        self.event_time = event_time</span><br><span class="line">        self.end_date = end_date</span><br><span class="line">        self.location = location</span><br><span class="line">        self.description = description</span><br><span class="line">        self.repeat = repeat</span><br><span class="line">        self.reminder_type = reminder_type</span><br><span class="line">        self.reminder_time = reminder_time</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;Event %r&gt;&#x27;</span> % self.title</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h2><p>考虑到业务需求,主要是对Event表进行CRUD操作,所以在<code>event</code>蓝图下创建了四个路由:</p><ul><li>&#x2F;event_list</li><li>&#x2F;creat_event</li><li>&#x2F;delete_event&#x2F;<a href="int:event_id">int:event_id</a></li><li>&#x2F;edit_event&#x2F;<a href="int:event_id">int:event_id</a></li></ul><p>创建<code>app/views/event_view.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># event_view.py  </span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint  </span><br><span class="line"><span class="keyword">from</span> app.controller <span class="keyword">import</span> event_controller <span class="comment"># 导入 event_controller 模块  </span></span><br><span class="line">  </span><br><span class="line">event_blueprint = Blueprint(<span class="string">&#x27;event&#x27;</span>, __name__)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 将视图函数与蓝图关联  </span></span><br><span class="line">event_blueprint.route(<span class="string">&#x27;/event_list&#x27;</span>)(event_controller.show_event)  </span><br><span class="line">event_blueprint.route(<span class="string">&#x27;/create_event&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>])(event_controller.create_event)  </span><br><span class="line">event_blueprint.route(<span class="string">&#x27;/delete_event/&lt;int:event_id&gt;&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>])(event_controller.delete_event)  </span><br><span class="line">event_blueprint.route(<span class="string">&#x27;/edit_event/&lt;int:event_id&gt;&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>])(event_controller.edit_event)  </span><br></pre></td></tr></table></figure><h2 id="创建控制器"><a href="#创建控制器" class="headerlink" title="创建控制器"></a>创建控制器</h2><p>明确了视图,现在只需要完成对Event表的CRUD即可，创建<code>app/controller/event_controller.py</code></p><h3 id="查询事件"><a href="#查询事件" class="headerlink" title="查询事件"></a>查询事件</h3><p>使用flask-login插件管理用户,利用@login_required装饰器获取当前登录用户的id。创建一个动态生成事件的函数<code>get_user_events</code>按照用户设置的规则动态生成将要在前端显示的事件,这样可以够支持用户设置特点频率的事件而且能避免数据库的负担过大。编写一个逻辑检查过期的事件并同未过期的事件一并返回。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_event</span>():</span><br><span class="line">    user_id = current_user.<span class="built_in">id</span>  <span class="comment"># 获取当前登录用户的ID</span></span><br><span class="line">    today_events, expired_events = get_user_events(user_id)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;event_list.html&#x27;</span>, events=today_events, expired_events=expired_events)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user_events</span>(<span class="params">user_id</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    查询当前用户的所有事件，并根据事件的重复规则生成今天的事件列表和过期事件列表。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        user_id (int): 用户ID</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        tuple: 包含今天的事件列表和过期事件列表的元组</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 查询当前用户的所有事件</span></span><br><span class="line">    events = Event.query.filter_by(user_id=user_id).<span class="built_in">all</span>()</span><br><span class="line">    today = datetime.now().date()  <span class="comment"># 获取当前日期</span></span><br><span class="line">    today_events = []</span><br><span class="line">    expired_events = []</span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> events:</span><br><span class="line">        <span class="comment"># 如果事件过期，将其添加到过期事件列表中</span></span><br><span class="line">        <span class="keyword">if</span> event.end_date &lt; today:</span><br><span class="line">            expired_events.append(event)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># 如果事件不是重复事件，将其添加到今天事件列表中</span></span><br><span class="line">        <span class="keyword">if</span> event.repeat == <span class="string">&quot;none&quot;</span> <span class="keyword">and</span> today &lt;= event.end_date:</span><br><span class="line">            today_events.append(event)</span><br><span class="line">        <span class="comment"># 如果事件是重复事件，动态生成后将其添加到今天事件列表中</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            start_date = event.start_date</span><br><span class="line">            end_date = event.end_date</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> event.repeat == <span class="string">&quot;daily&quot;</span>:</span><br><span class="line">                current_date = start_date</span><br><span class="line">                <span class="keyword">while</span> current_date &lt;= end_date:</span><br><span class="line">                    <span class="keyword">if</span> current_date &gt;= today:</span><br><span class="line">                        new_event = generate_repeat_event(event, current_date)</span><br><span class="line">                        today_events.append(new_event)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    current_date += timedelta(days=<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">elif</span> event.repeat == <span class="string">&quot;weekly&quot;</span>:</span><br><span class="line">                <span class="keyword">if</span> end_date-today &lt; timedelta(days=<span class="number">7</span>):</span><br><span class="line">                    expired_events.append(event)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                current_date = start_date</span><br><span class="line">                <span class="keyword">while</span> current_date &lt;= end_date:</span><br><span class="line">                    <span class="keyword">if</span> current_date &gt;= today:</span><br><span class="line">                        last_week_event = generate_repeat_event(event, current_date)</span><br><span class="line">                        today_events.append(last_week_event)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    current_date += timedelta(weeks=<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">elif</span> event.repeat == <span class="string">&quot;monthly&quot;</span>:</span><br><span class="line">                <span class="keyword">if</span> end_date-today &lt; timedelta(days=<span class="number">30</span>):</span><br><span class="line">                    expired_events.append(event)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                current_date = start_date</span><br><span class="line">                <span class="keyword">while</span> current_date &lt;= end_date:</span><br><span class="line">                    <span class="keyword">if</span> current_date &gt;= today:</span><br><span class="line">                        last_month_event = generate_repeat_event(event, current_date)</span><br><span class="line">                        today_events.append(last_month_event)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    current_date += timedelta(days=<span class="number">30</span>)</span><br><span class="line">    <span class="keyword">return</span> today_events, expired_events</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个函数，用于生成重复事件</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_repeat_event</span>(<span class="params">event, current_date</span>):</span><br><span class="line">    new_event = Event(</span><br><span class="line">        user_id=event.user_id,</span><br><span class="line">        title=event.title,</span><br><span class="line">        start_date=current_date,</span><br><span class="line">        end_date=current_date,</span><br><span class="line">        event_time=event.event_time,</span><br><span class="line">        location=event.location,</span><br><span class="line">        description=event.description,</span><br><span class="line">        repeat=event.repeat,</span><br><span class="line">        reminder_type=event.reminder_type,</span><br><span class="line">        reminder_time=event.reminder_time</span><br><span class="line">    )</span><br><span class="line">    new_event.<span class="built_in">id</span> = event.<span class="built_in">id</span>  <span class="comment"># 设置新事件的ID为原事件的ID</span></span><br><span class="line">    <span class="keyword">return</span> new_event```</span><br><span class="line"></span><br><span class="line"><span class="comment">### 创建事件</span></span><br><span class="line"></span><br><span class="line">在用户提交表单之前,使用表单验证能够有效规范数据库在forms.py上加入对Event的表单验证:</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"><span class="comment"># forms.py</span></span><br><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> FlaskForm</span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> StringField, PasswordField, validators, SubmitField, ValidationError, DateField, TimeField</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RegisterForm</span>(<span class="title class_ inherited__">FlaskForm</span>):</span><br><span class="line">    name = StringField(<span class="string">&#x27;用户名&#x27;</span>, [validators.DataRequired(<span class="string">&quot;用户名不能为空&quot;</span>)])</span><br><span class="line">    email = StringField(<span class="string">&#x27;邮箱&#x27;</span>, [validators.DataRequired(<span class="string">&quot;邮箱不能为空&quot;</span>), validators.Email(<span class="string">&quot;无效的邮箱地址&quot;</span>)])</span><br><span class="line">    phone = StringField(<span class="string">&#x27;电话&#x27;</span>)</span><br><span class="line">    password = PasswordField(<span class="string">&#x27;密码&#x27;</span>, [</span><br><span class="line">        validators.DataRequired(<span class="string">&quot;密码不能为空&quot;</span>),</span><br><span class="line">        validators.Length(<span class="built_in">min</span>=<span class="number">8</span>, message=<span class="string">&quot;密码长度至少 8 个字符&quot;</span>)</span><br><span class="line">    ])</span><br><span class="line">    confirm_password = PasswordField(<span class="string">&#x27;确认密码&#x27;</span>, [</span><br><span class="line">        validators.DataRequired(<span class="string">&quot;请再次输入密码&quot;</span>),</span><br><span class="line">        validators.EqualTo(<span class="string">&#x27;password&#x27;</span>, message=<span class="string">&#x27;两次密码不匹配&#x27;</span>)</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginForm</span>(<span class="title class_ inherited__">FlaskForm</span>):</span><br><span class="line">    email = StringField(<span class="string">&#x27;邮箱&#x27;</span>, [validators.DataRequired(<span class="string">&quot;邮箱不能为空&quot;</span>), validators.Email(<span class="string">&quot;无效的邮箱地址&quot;</span>)])</span><br><span class="line">    password = PasswordField(<span class="string">&#x27;密码&#x27;</span>, [validators.DataRequired(<span class="string">&quot;密码不能为空&quot;</span>)])</span><br><span class="line">    remember = StringField(<span class="string">&#x27;记住我&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EventForm</span>(<span class="title class_ inherited__">FlaskForm</span>):</span><br><span class="line">    title = StringField(<span class="string">&#x27;标题&#x27;</span>, validators=[validators.DataRequired(), validators.Length(<span class="built_in">max</span>=<span class="number">255</span>)])</span><br><span class="line">    start_date = DateField(<span class="string">&#x27;开始日期&#x27;</span>, <span class="built_in">format</span>=<span class="string">&#x27;%Y-%m-%d&#x27;</span>, validators=[validators.DataRequired()])</span><br><span class="line">    event_time = TimeField(<span class="string">&#x27;事件时间&#x27;</span>, <span class="built_in">format</span>=<span class="string">&#x27;%H:%M&#x27;</span>)</span><br><span class="line">    end_date = DateField(<span class="string">&#x27;结束时间&#x27;</span>, <span class="built_in">format</span>=<span class="string">&#x27;%Y-%m-%d&#x27;</span>)</span><br><span class="line">    location = StringField(<span class="string">&#x27;地点&#x27;</span>, validators=[validators.Length(<span class="built_in">max</span>=<span class="number">255</span>)])</span><br><span class="line">    description = StringField(<span class="string">&#x27;描述&#x27;</span>, validators=[validators.Length(<span class="built_in">max</span>=<span class="number">255</span>)])</span><br><span class="line">    repeat = StringField(<span class="string">&#x27;重复&#x27;</span>)</span><br><span class="line">    reminder_type = StringField(<span class="string">&#x27;提醒类型&#x27;</span>, validators=[validators.DataRequired()])</span><br><span class="line">    reminder_time = StringField(<span class="string">&#x27;提醒时间&#x27;</span>)</span><br><span class="line">    submit = SubmitField(<span class="string">&#x27;Submit&#x27;</span>)  <span class="comment"># 添加这一行来定义 submit 字段</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果结束时间小于或等于开始时间，则引发验证错误。</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_end_time</span>(<span class="params">self, field</span>):</span><br><span class="line">        <span class="keyword">if</span> field.data &lt;= self.start_date.data:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">&#x27;End time must be greater than start time&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>编写创建事件逻辑:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_event</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    创建事件并保存到数据库。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    return: 重定向到事件列表页面或其他适当的页面</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    form = EventForm()  <span class="comment"># 使用您的事件表单来接收用户输入</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> form.validate_on_submit():</span><br><span class="line">        <span class="keyword">for</span> field, errors <span class="keyword">in</span> form.errors.items():</span><br><span class="line">            <span class="keyword">for</span> error <span class="keyword">in</span> errors:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;字段 <span class="subst">&#123;field&#125;</span> 中的错误: <span class="subst">&#123;error&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        <span class="comment"># 获取用户输入的事件信息</span></span><br><span class="line">        title = form.title.data</span><br><span class="line">        event_time = form.event_time.data</span><br><span class="line">        start_date = form.start_date.data</span><br><span class="line">        end_date = form.end_date.data</span><br><span class="line">        location = form.location.data</span><br><span class="line">        description = form.description.data</span><br><span class="line">        repeat = form.repeat.data  <span class="comment"># 从表单获取重复类型</span></span><br><span class="line">        reminder_type = form.reminder_type.data</span><br><span class="line">        reminder_time = form.reminder_time.data</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 创建事件对象并保存到数据库</span></span><br><span class="line">        event = Event(</span><br><span class="line">            user_id=current_user.<span class="built_in">id</span>,  <span class="comment"># 使用当前登录用户的 ID</span></span><br><span class="line">            title=title,</span><br><span class="line">            event_time=event_time,</span><br><span class="line">            start_date=start_date,</span><br><span class="line">            end_date=end_date,</span><br><span class="line">            location=location,</span><br><span class="line">            description=description,</span><br><span class="line">            repeat=repeat,  <span class="comment"># 设置事件的重复类型</span></span><br><span class="line">            reminder_type=reminder_type,</span><br><span class="line">            reminder_time=reminder_time</span><br><span class="line">        )</span><br><span class="line">        db.session.add(event)</span><br><span class="line">        db.session.commit()</span><br><span class="line"></span><br><span class="line">        flash(<span class="string">&#x27;事件创建成功&#x27;</span>, <span class="string">&#x27;success&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;event.show_event&#x27;</span>))  <span class="comment"># 重定向到事件列表页面或其他适当的页面</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;create_event.html&#x27;</span>, form=form)</span><br></pre></td></tr></table></figure><h3 id="删除事件"><a href="#删除事件" class="headerlink" title="删除事件"></a>删除事件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_event</span>(<span class="params">event_id</span>):</span><br><span class="line">    <span class="comment"># 查询要删除的事件</span></span><br><span class="line">    event = Event.query.get(event_id)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 检查事件是否存在并属于当前用户</span></span><br><span class="line">    <span class="keyword">if</span> event <span class="keyword">and</span> event.user_id == current_user.<span class="built_in">id</span>:</span><br><span class="line">        db.session.delete(event)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">&#x27;事件删除成功&#x27;</span>, <span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flash(<span class="string">&#x27;无法删除事件&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;event.show_event&#x27;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="编辑事件"><a href="#编辑事件" class="headerlink" title="编辑事件"></a>编辑事件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit_event</span>(<span class="params">event_id</span>):</span><br><span class="line">    <span class="comment"># 查询要编辑的事件</span></span><br><span class="line">    event = Event.query.get(event_id)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 检查事件是否存在并属于当前用户</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> event <span class="keyword">or</span> event.user_id != current_user.<span class="built_in">id</span>:</span><br><span class="line">        flash(<span class="string">&#x27;无法编辑事件&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;event.show_event&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    form = EventForm(obj=event)  <span class="comment"># 使用事件对象填充表单</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        <span class="comment"># 更新事件信息</span></span><br><span class="line">        event.title = form.title.data</span><br><span class="line">        event.event_time = form.event_time.data</span><br><span class="line">        event.start_date = form.start_date.data</span><br><span class="line">        event.end_date = form.end_date.data</span><br><span class="line">        event.location = form.location.data</span><br><span class="line">        event.description = form.description.data</span><br><span class="line">        event.repeat = form.repeat.data  <span class="comment"># 从表单获取重复类型</span></span><br><span class="line">        event.reminder_type = form.reminder_type.data</span><br><span class="line">        event.reminder_time = form.reminder_time.data</span><br><span class="line"></span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">&#x27;事件更新成功&#x27;</span>, <span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;event.show_event&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;edit_event.html&#x27;</span>, form=form)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="前端页面"><a href="#前端页面" class="headerlink" title="前端页面"></a>前端页面</h1><p>完成了后端的逻辑,接下来只需要通过jinja2语法创建模板即可。由于html代码可读性差，以下使用项目的初始demo来说明。demo中只有jinja2接口，基本上没有任何样式，但是代码可读性强。</p><h2 id="构建-event-event-list对应的页面"><a href="#构建-event-event-list对应的页面" class="headerlink" title="构建 /event/event_list对应的页面"></a>构建 <code>/event/event_list</code>对应的页面</h2><p>创建模板<code>app/templates/event_list.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>事件列表<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>事件列表<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--显示待执行的事件--&gt;</span></span><br><span class="line">        &#123;% for event in events %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123; event.title &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>日期：<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>&#123;&#123; event.start_date &#125;&#125; - &#123;&#123; event.end_date &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>时间：<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>&#123;&#123; event.event_time &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>地点：<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>&#123;&#123; event.location &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>描述：<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>&#123;&#123; event.description &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>重复：<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>&#123;&#123; event.repeat &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>提醒类型:<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>&#123;&#123; event.reminder_type &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                &#123;% with days=event.reminder_time // (24 * 60), hours=(event.reminder_time % (24 * 60)) // 60, minutes=(event.reminder_time % 60) %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>提醒时间:<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>&#123;&#123; days &#125;&#125; 天 &#123;&#123; hours &#125;&#125; 小时 &#123;&#123; minutes &#125;&#125; 分钟<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                &#123;% endwith %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;event.edit_event&#x27;, event_id=event.id) &#125;&#125;&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;event.delete_event&#x27;, event_id=event.id) &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;删除&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="comment">&lt;!--显示过期的事件--&gt;</span></span><br><span class="line">        &#123;% for event in expired_events %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">style</span>=<span class="string">&quot;color: gray&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123; event.title &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;color: red&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>日期：<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>&#123;&#123; event.start_date &#125;&#125; - &#123;&#123; event.end_date &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>时间：<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>&#123;&#123; event.event_time &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>地点：<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>&#123;&#123; event.location &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>描述：<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>&#123;&#123; event.description &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>重复：<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>&#123;&#123; event.repeat &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>提醒类型:<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>&#123;&#123; event.reminder_type &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                &#123;% with days=event.reminder_time // (24 * 60), hours=(event.reminder_time % (24 * 60)) // 60, minutes=(event.reminder_time % 60) %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>提醒时间:<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>&#123;&#123; days &#125;&#125; 天 &#123;&#123; hours &#125;&#125; 小时 &#123;&#123; minutes &#125;&#125; 分钟<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                &#123;% endwith %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;event.edit_event&#x27;, event_id=event.id) &#125;&#125;&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;event.delete_event&#x27;, event_id=event.id) &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;删除&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;event.create_event&#x27;) &#125;&#125;&quot;</span>&gt;</span>创建事件<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="构建-event-creat-event-对应的页面"><a href="#构建-event-creat-event-对应的页面" class="headerlink" title="构建 /event/creat_event 对应的页面"></a>构建 <code>/event/creat_event</code> 对应的页面</h2><p>创建模板 <code>app/templates/create_event.html</code>，注意需要在提交表单前加上<code>&#123;&#123; form.hidden_tag() &#125;&#125;</code>保证通过表单验证</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Create Event<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;css/http_cdn.jsdelivr.net_npm_flatpickr_dist_flatpickr.css&#x27;) &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;js/http_cdn.jsdelivr.net_npm_flatpickr.js&#x27;) &#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Create Event<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">onsubmit</span>=<span class="string">&quot;combineAndSubmit()&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123; form.hidden_tag() &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.title.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">            &#123;&#123; form.title(class=&quot;form-control&quot;) &#125;&#125;</span><br><span class="line">            &#123;% for error in form.title.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.start_date.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">            &#123;&#123; form.start_date(class=&quot;form-control flatpickr&quot;,id=&quot;start_date&quot;) &#125;&#125;</span><br><span class="line">            &#123;% for error in form.start_date.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.event_time.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">            &#123;&#123; form.event_time(class=&quot;form-control flatpickr&quot;,id=&quot;event_time&quot;) &#125;&#125;</span><br><span class="line">            &#123;% for error in form.event_time.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.end_date.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">            &#123;&#123; form.end_date(class=&quot;form-control, flatpickr&quot;,id=&quot;end_date&quot;) &#125;&#125;</span><br><span class="line">            &#123;% for error in form.end_date.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.location.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">            &#123;&#123; form.location(class=&quot;form-control&quot;) &#125;&#125;</span><br><span class="line">            &#123;% for error in form.location.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.description.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">            &#123;&#123; form.description(class=&quot;form-control&quot;) &#125;&#125;</span><br><span class="line">            &#123;% for error in form.description.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;repeatSelect&quot;</span>&gt;</span>&#123;&#123; form.repeat.label(class=&quot;form-label&quot;) &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;repeat&quot;</span> <span class="attr">id</span>=<span class="string">&quot;repeatSelect&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;none&quot;</span>&gt;</span>无<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;daily&quot;</span>&gt;</span>每天<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;weekly&quot;</span>&gt;</span>每周<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;month&quot;</span>&gt;</span>每月<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">            &#123;% for error in form.repeat.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;reminder_type&quot;</span>&gt;</span>&#123;&#123; form.reminder_type.label(class=&quot;form-label&quot;) &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;reminder_type&quot;</span> <span class="attr">id</span>=<span class="string">&quot;reminder_type&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;none&quot;</span>&gt;</span>无<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;email&quot;</span>&gt;</span>邮箱<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;phone&quot;</span>&gt;</span>手机<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;pepper&quot;</span>&gt;</span>机器人<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">            &#123;% for error in form.reminder_type.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.reminder_time.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">             <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;设置提醒&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;showReminderOptions()&quot;</span>&gt;</span></span><br><span class="line">            &#123;% for error in form.reminder_time.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;reminderOptions&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;daysInput&quot;</span>&gt;</span>天数：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">id</span>=<span class="string">&quot;daysInput&quot;</span> <span class="attr">name</span>=<span class="string">&quot;daysInput&quot;</span> <span class="attr">min</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;hoursInput&quot;</span>&gt;</span>小时：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;hoursInput&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hoursInput&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 使用 JavaScript 动态生成选项 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;minutesInput&quot;</span>&gt;</span>分钟：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;minutesInput&quot;</span> <span class="attr">name</span>=<span class="string">&quot;minutesInput&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 使用 JavaScript 动态生成选项 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 隐藏的input元素用于存储提醒时间 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;reminder_time&quot;</span> <span class="attr">id</span>=<span class="string">&quot;reminder_time&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.submit()&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">flatpickr</span>(<span class="string">&#x27;#start_date&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">enableTime</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">dateFormat</span>: <span class="string">&quot;Y-m-d&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">flatpickr</span>(<span class="string">&#x27;#event_time&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">enableTime</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">noCalendar</span>: <span class="literal">true</span>, <span class="comment">// 禁用日期选择</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">time_24hr</span>: <span class="literal">true</span>, <span class="comment">// 使用24小时制</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">dateFormat</span>: <span class="string">&quot;H:i&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">flatpickr</span>(<span class="string">&#x27;#end_date&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">enableTime</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">dateFormat</span>: <span class="string">&quot;Y-m-d&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">populateOptions</span>(<span class="params">element, max</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= max; i++) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> option = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;option&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            option.<span class="property">value</span> = i;</span></span><br><span class="line"><span class="language-javascript">            option.<span class="property">text</span> = i;</span></span><br><span class="line"><span class="language-javascript">            element.<span class="title function_">appendChild</span>(option);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 动态生成小时和分钟的选项</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">populateOptions</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;hoursInput&#x27;</span>), <span class="number">24</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">populateOptions</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;minutesInput&#x27;</span>), <span class="number">60</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">showReminderOptions</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 显示设置提醒时间的选项</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;reminderOptions&#x27;</span>).<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;block&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">combineAndSubmit</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> daysInput = <span class="built_in">parseFloat</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;daysInput&#x27;</span>).<span class="property">value</span>) || <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> hoursInput = <span class="built_in">parseFloat</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;hoursInput&#x27;</span>).<span class="property">value</span>) || <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> minutesInput = <span class="built_in">parseFloat</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;minutesInput&#x27;</span>).<span class="property">value</span>) || <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 转换为分钟</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> totalMinutes = daysInput * <span class="number">24</span> * <span class="number">60</span> + hoursInput * <span class="number">60</span> + minutesInput;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 将totalMinutes设置到表单的form.reminder_time字段</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;reminder_time&#x27;</span>).<span class="property">value</span> = totalMinutes;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 可以将表单提交到服务器或进行其他操作</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">alert</span>(<span class="string">&quot;总时间（分钟）：&quot;</span> + totalMinutes);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="构建-event-edit-event-对应的页面"><a href="#构建-event-edit-event-对应的页面" class="headerlink" title="构建 /event/edit_event/ 对应的页面"></a>构建 <code>/event/edit_event/</code> 对应的页面</h2><p>创建模板 <code>app/templates/edit_event.html</code>,<code>/event/delete_event/</code> 路由没有页面,而是通过按钮来触发并删除事件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Create Event<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;css/http_cdn.jsdelivr.net_npm_flatpickr_dist_flatpickr.css&#x27;) &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;js/http_cdn.jsdelivr.net_npm_flatpickr.js&#x27;) &#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Create Event<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">onsubmit</span>=<span class="string">&quot;combineAndSubmit()&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123; form.hidden_tag() &#125;&#125;<span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Edit Event<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;css/http_cdn.jsdelivr.net_npm_flatpickr_dist_flatpickr.css&#x27;) &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;js/http_cdn.jsdelivr.net_npm_flatpickr.js&#x27;) &#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Edit Event<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">onsubmit</span>=<span class="string">&quot;combineAndSubmit()&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123; form.hidden_tag() &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.title.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">            &#123;&#123; form.title(class=&quot;form-control&quot;) &#125;&#125;</span><br><span class="line">            &#123;% for error in form.title.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.start_date.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">            &#123;&#123; form.start_date(class=&quot;form-control flatpickr&quot;,id=&quot;start_date&quot;) &#125;&#125;</span><br><span class="line">            &#123;% for error in form.start_date.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.event_time.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">            &#123;&#123; form.event_time(class=&quot;form-control flatpickr&quot;,id=&quot;event_time&quot;) &#125;&#125;</span><br><span class="line">            &#123;% for error in form.event_time.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.end_date.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">            &#123;&#123; form.end_date(class=&quot;form-control, flatpickr&quot;,id=&quot;end_date&quot;) &#125;&#125;</span><br><span class="line">            &#123;% for error in form.end_date.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.location.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">            &#123;&#123; form.location(class=&quot;form-control&quot;) &#125;&#125;</span><br><span class="line">            &#123;% for error in form.location.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.description.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">            &#123;&#123; form.description(class=&quot;form-control&quot;) &#125;&#125;</span><br><span class="line">            &#123;% for error in form.description.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;repeatSelect&quot;</span>&gt;</span>&#123;&#123; form.repeat.label(class=&quot;form-label&quot;) &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;repeat&quot;</span> <span class="attr">id</span>=<span class="string">&quot;repeatSelect&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;none&quot;</span> &#123;% <span class="attr">if</span> <span class="attr">form.repeat.data</span> == <span class="string">&#x27;none&#x27;</span> %&#125;<span class="attr">selected</span>&#123;% <span class="attr">endif</span> %&#125;&gt;</span>无<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;daily&quot;</span> &#123;% <span class="attr">if</span> <span class="attr">form.repeat.data</span> == <span class="string">&#x27;daily&#x27;</span>%&#125;<span class="attr">selected</span>&#123;% <span class="attr">endif</span> %&#125;&gt;</span>每天<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;weekly&quot;</span> &#123;% <span class="attr">if</span> <span class="attr">form.repeat.data</span> == <span class="string">&#x27;weekly&#x27;</span> %&#125;<span class="attr">selected</span>&#123;% <span class="attr">endif</span> %&#125;&gt;</span>每周<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;month&quot;</span> &#123;% <span class="attr">if</span> <span class="attr">form.repeat.data</span> == <span class="string">&#x27;month&#x27;</span> %&#125;<span class="attr">selected</span>&#123;% <span class="attr">endif</span> %&#125;&gt;</span>每月<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">            &#123;% for error in form.repeat.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;reminder_type&quot;</span>&gt;</span>&#123;&#123; form.reminder_type.label(class=&quot;form-label&quot;) &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;reminder_type&quot;</span> <span class="attr">id</span>=<span class="string">&quot;reminder_type&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;none&quot;</span> &#123;% <span class="attr">if</span> <span class="attr">form.reminder_type.data</span> == <span class="string">&#x27;none&#x27;</span> %&#125;<span class="attr">selected</span>&#123;% <span class="attr">endif</span> %&#125;&gt;</span>无<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;email&quot;</span> &#123;% <span class="attr">if</span> <span class="attr">form.reminder_type.data</span> == <span class="string">&#x27;email&#x27;</span> %&#125;<span class="attr">selected</span>&#123;% <span class="attr">endif</span> %&#125;&gt;</span>邮箱<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;phone&quot;</span> &#123;% <span class="attr">if</span> <span class="attr">form.reminder_type.data</span> == <span class="string">&#x27;phone&#x27;</span> %&#125;<span class="attr">selected</span>&#123;% <span class="attr">endif</span> %&#125;&gt;</span>手机<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;pepper&quot;</span> &#123;% <span class="attr">if</span> <span class="attr">form.reminder_type.data</span> == <span class="string">&#x27;pepper&#x27;</span> %&#125;<span class="attr">selected</span>&#123;% <span class="attr">endif</span> %&#125;&gt;</span>机器人<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">            &#123;% for error in form.reminder_type.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.reminder_time.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">            &#123;&#123; form.reminder_time(class=&quot;form-control&quot;,style=&quot;display: none;&quot;) &#125;&#125;</span><br><span class="line">             <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;设置提醒&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;showReminderOptions()&quot;</span>&gt;</span></span><br><span class="line">            &#123;% for error in form.reminder_time.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;reminderOptions&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;daysInput&quot;</span>&gt;</span>天数：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">id</span>=<span class="string">&quot;daysInput&quot;</span> <span class="attr">name</span>=<span class="string">&quot;daysInput&quot;</span> <span class="attr">min</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;hoursInput&quot;</span>&gt;</span>小时：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;hoursInput&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hoursInput&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 使用 JavaScript 动态生成选项 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;minutesInput&quot;</span>&gt;</span>分钟：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;minutesInput&quot;</span> <span class="attr">name</span>=<span class="string">&quot;minutesInput&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 使用 JavaScript 动态生成选项 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 隐藏的input元素用于存储提醒时间 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;reminder_time&quot;</span> <span class="attr">id</span>=<span class="string">&quot;reminder_time&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.submit()&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">flatpickr</span>(<span class="string">&#x27;#start_date&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">enableTime</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">dateFormat</span>: <span class="string">&quot;Y-m-d&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">flatpickr</span>(<span class="string">&#x27;#event_time&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">enableTime</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">noCalendar</span>: <span class="literal">true</span>, <span class="comment">// 禁用日期选择</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">time_24hr</span>: <span class="literal">true</span>, <span class="comment">// 使用24小时制</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">dateFormat</span>: <span class="string">&quot;H:i&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">flatpickr</span>(<span class="string">&#x27;#end_date&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">enableTime</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">dateFormat</span>: <span class="string">&quot;Y-m-d&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">populateOptions</span>(<span class="params">element, max</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= max; i++) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> option = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;option&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            option.<span class="property">value</span> = i;</span></span><br><span class="line"><span class="language-javascript">            option.<span class="property">text</span> = i;</span></span><br><span class="line"><span class="language-javascript">            element.<span class="title function_">appendChild</span>(option);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 动态生成小时和分钟的选项</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">populateOptions</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;hoursInput&#x27;</span>), <span class="number">24</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">populateOptions</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;minutesInput&#x27;</span>), <span class="number">60</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> isReminderChanged = <span class="literal">false</span>; <span class="comment">// 添加标志变量，用于判断是否更改了提醒时间</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">showReminderOptions</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 显示提醒选项时将标志变量设置为 true</span></span></span><br><span class="line"><span class="language-javascript">        isReminderChanged = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> reminderTime = <span class="built_in">parseFloat</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;reminder_time&quot;</span>).<span class="property">value</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 计算天数、小时和分钟</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> days = <span class="title class_">Math</span>.<span class="title function_">floor</span>(reminderTime / (<span class="number">24</span> * <span class="number">60</span>));</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> hours = <span class="title class_">Math</span>.<span class="title function_">floor</span>((reminderTime % (<span class="number">24</span> * <span class="number">60</span>)) / <span class="number">60</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> minutes = reminderTime % <span class="number">60</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 更新隐藏的三个选项框的值</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;daysInput&quot;</span>).<span class="property">value</span> = days;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;hoursInput&quot;</span>).<span class="property">value</span> = hours;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;minutesInput&quot;</span>).<span class="property">value</span> = minutes;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 显示设置提醒时间的选项</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;reminderOptions&#x27;</span>).<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;block&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">combineAndSubmit</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (isReminderChanged) &#123; <span class="comment">// 只有在提醒时间发生更改时才执行以下逻辑</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> daysInput = <span class="built_in">parseFloat</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;daysInput&#x27;</span>).<span class="property">value</span>) || <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> hoursInput = <span class="built_in">parseFloat</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;hoursInput&#x27;</span>).<span class="property">value</span>) || <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> minutesInput = <span class="built_in">parseFloat</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;minutesInput&#x27;</span>).<span class="property">value</span>) || <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 转换为分钟</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> totalMinutes = daysInput * <span class="number">24</span> * <span class="number">60</span> + hoursInput * <span class="number">60</span> + minutesInput;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 将totalMinutes设置到表单的form.reminder_time字段</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;reminder_time&#x27;</span>).<span class="property">value</span> = totalMinutes;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 可以将表单提交到服务器或进行其他操作</span></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">&quot;总时间（分钟）：&quot;</span> + totalMinutes);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">         <span class="comment">// 重置标志变量</span></span></span><br><span class="line"><span class="language-javascript">        isReminderChanged = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.title.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">            &#123;&#123; form.title(class=&quot;form-control&quot;) &#125;&#125;</span><br><span class="line">            &#123;% for error in form.title.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.start_date.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">            &#123;&#123; form.start_date(class=&quot;form-control flatpickr&quot;,id=&quot;start_date&quot;) &#125;&#125;</span><br><span class="line">            &#123;% for error in form.start_date.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.event_time.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">            &#123;&#123; form.event_time(class=&quot;form-control flatpickr&quot;,id=&quot;event_time&quot;) &#125;&#125;</span><br><span class="line">            &#123;% for error in form.event_time.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.end_date.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">            &#123;&#123; form.end_date(class=&quot;form-control, flatpickr&quot;,id=&quot;end_date&quot;) &#125;&#125;</span><br><span class="line">            &#123;% for error in form.end_date.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.location.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">            &#123;&#123; form.location(class=&quot;form-control&quot;) &#125;&#125;</span><br><span class="line">            &#123;% for error in form.location.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.description.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">            &#123;&#123; form.description(class=&quot;form-control&quot;) &#125;&#125;</span><br><span class="line">            &#123;% for error in form.description.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;repeatSelect&quot;</span>&gt;</span>&#123;&#123; form.repeat.label(class=&quot;form-label&quot;) &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;repeat&quot;</span> <span class="attr">id</span>=<span class="string">&quot;repeatSelect&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;none&quot;</span>&gt;</span>无<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;daily&quot;</span>&gt;</span>每天<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;weekly&quot;</span>&gt;</span>每周<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;month&quot;</span>&gt;</span>每月<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">            &#123;% for error in form.repeat.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;reminder_type&quot;</span>&gt;</span>&#123;&#123; form.reminder_type.label(class=&quot;form-label&quot;) &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;reminder_type&quot;</span> <span class="attr">id</span>=<span class="string">&quot;reminder_type&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;none&quot;</span>&gt;</span>无<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;email&quot;</span>&gt;</span>邮箱<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;phone&quot;</span>&gt;</span>手机<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;pepper&quot;</span>&gt;</span>机器人<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">            &#123;% for error in form.reminder_type.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.reminder_time.label(class=&quot;form-label&quot;) &#125;&#125;</span><br><span class="line">             <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;设置提醒&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;showReminderOptions()&quot;</span>&gt;</span></span><br><span class="line">            &#123;% for error in form.reminder_time.errors %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;reminderOptions&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;daysInput&quot;</span>&gt;</span>天数：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">id</span>=<span class="string">&quot;daysInput&quot;</span> <span class="attr">name</span>=<span class="string">&quot;daysInput&quot;</span> <span class="attr">min</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;hoursInput&quot;</span>&gt;</span>小时：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;hoursInput&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hoursInput&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 使用 JavaScript 动态生成选项 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;minutesInput&quot;</span>&gt;</span>分钟：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;minutesInput&quot;</span> <span class="attr">name</span>=<span class="string">&quot;minutesInput&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 使用 JavaScript 动态生成选项 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 隐藏的input元素用于存储提醒时间 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;reminder_time&quot;</span> <span class="attr">id</span>=<span class="string">&quot;reminder_time&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.submit()&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">flatpickr</span>(<span class="string">&#x27;#start_date&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">enableTime</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">dateFormat</span>: <span class="string">&quot;Y-m-d&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">flatpickr</span>(<span class="string">&#x27;#event_time&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">enableTime</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">noCalendar</span>: <span class="literal">true</span>, <span class="comment">// 禁用日期选择</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">time_24hr</span>: <span class="literal">true</span>, <span class="comment">// 使用24小时制</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">dateFormat</span>: <span class="string">&quot;H:i&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">flatpickr</span>(<span class="string">&#x27;#end_date&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">enableTime</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">dateFormat</span>: <span class="string">&quot;Y-m-d&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">populateOptions</span>(<span class="params">element, max</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= max; i++) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> option = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;option&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            option.<span class="property">value</span> = i;</span></span><br><span class="line"><span class="language-javascript">            option.<span class="property">text</span> = i;</span></span><br><span class="line"><span class="language-javascript">            element.<span class="title function_">appendChild</span>(option);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 动态生成小时和分钟的选项</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">populateOptions</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;hoursInput&#x27;</span>), <span class="number">24</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">populateOptions</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;minutesInput&#x27;</span>), <span class="number">60</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">showReminderOptions</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 显示设置提醒时间的选项</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;reminderOptions&#x27;</span>).<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;block&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">combineAndSubmit</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> daysInput = <span class="built_in">parseFloat</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;daysInput&#x27;</span>).<span class="property">value</span>) || <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> hoursInput = <span class="built_in">parseFloat</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;hoursInput&#x27;</span>).<span class="property">value</span>) || <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> minutesInput = <span class="built_in">parseFloat</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;minutesInput&#x27;</span>).<span class="property">value</span>) || <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 转换为分钟</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> totalMinutes = daysInput * <span class="number">24</span> * <span class="number">60</span> + hoursInput * <span class="number">60</span> + minutesInput;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 将totalMinutes设置到表单的form.reminder_time字段</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;reminder_time&#x27;</span>).<span class="property">value</span> = totalMinutes;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 可以将表单提交到服务器或进行其他操作</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">alert</span>(<span class="string">&quot;总时间（分钟）：&quot;</span> + totalMinutes);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="效果呈现"><a href="#效果呈现" class="headerlink" title="效果呈现"></a>效果呈现</h1><p><strong>注：以下效果图的html代码并非以上的代码，而是通过优化后的效果</strong></p><h2 id="event-event-list"><a href="#event-event-list" class="headerlink" title="&#x2F;event&#x2F;event_list"></a>&#x2F;event&#x2F;event_list</h2><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/202312122050201.png" alt="image.png"></p><h2 id="event-creat-event"><a href="#event-creat-event" class="headerlink" title="&#x2F;event&#x2F;creat_event"></a>&#x2F;event&#x2F;creat_event</h2><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/202312122051659.png" alt="image.png"></p><h2 id="event-edit-event"><a href="#event-edit-event" class="headerlink" title="&#x2F;event&#x2F;edit_event&#x2F;"></a>&#x2F;event&#x2F;edit_event&#x2F;</h2><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/202312122052073.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pepper </tag>
            
            <tag> python </tag>
            
            <tag> choregraphe </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【Pepper机器人管家（二）】项目组成-Web开发篇：后端</title>
      <link href="/2023/12/11/%E3%80%90Pepper%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%AE%A1%E5%AE%B6%EF%BC%88%E4%BA%8C%EF%BC%89%E3%80%91%E9%A1%B9%E7%9B%AE%E7%BB%84%E6%88%90-Web%E5%BC%80%E5%8F%91%E7%AF%87-%E7%94%A8%E6%88%B7%E9%80%BB%E8%BE%91%E7%9A%84%E5%88%9B%E5%BB%BA/"/>
      <url>/2023/12/11/%E3%80%90Pepper%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%AE%A1%E5%AE%B6%EF%BC%88%E4%BA%8C%EF%BC%89%E3%80%91%E9%A1%B9%E7%9B%AE%E7%BB%84%E6%88%90-Web%E5%BC%80%E5%8F%91%E7%AF%87-%E7%94%A8%E6%88%B7%E9%80%BB%E8%BE%91%E7%9A%84%E5%88%9B%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="项目概述"><a href="#项目概述" class="headerlink" title="项目概述"></a>项目概述</h1><p>Web模块的大致结构是基于MVC架构的flask+jinja2+mysql的前后端不分离的结构，大致结构已经在上篇中介绍了，这里不做赘述了。由于项目需求比较简单而且需求特殊，后端选择自己构建导致有些用法并不完全满足falsk的开发规范。前端没有使用框架，而是使用开源项目二次开发，代码中有许多冗余。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">│  README.md</span><br><span class="line">│  .env //环境变量</span><br><span class="line">│  app.log //运行日志</span><br><span class="line">│  runserver.py //项目启动文件</span><br><span class="line">│  requirements.txt //项目依赖</span><br><span class="line">├─app</span><br><span class="line">│  │  config.py //配置文件,数据库连接(需要在环境变量中加入此路径)</span><br><span class="line">│  │  forms.py //验证表单程序</span><br><span class="line">│  │  __init__.py //模块初始化文件，Flask 程序对象的创建须在 __init__.py 文件里完成</span><br><span class="line">│  │  wsgi.py //wsgi服务启动</span><br><span class="line">│  │</span><br><span class="line">│  ├─controller //MVC中的控制器(C)</span><br><span class="line">│  │     event_controller.py //事件控制器</span><br><span class="line">│  │     api_controller.py //api控制器</span><br><span class="line">│  │     user_controller.py //用户控制器</span><br><span class="line">│  │     reminder_controller.py //提醒控制器</span><br><span class="line">│  │  </span><br><span class="line">│  ├─model //MVC中的模型,数据库中的表(M)</span><br><span class="line">│  │     Event.py //事件表</span><br><span class="line">│  │     User.py //用户表</span><br><span class="line">│  │     EmailHistory //邮件历史记录</span><br><span class="line">│  │</span><br><span class="line">│  ├─views //MVC中的视图(V)</span><br><span class="line">│  │     admin_view.py //管理员</span><br><span class="line">│  │     event_view.py //事件</span><br><span class="line">│  │     index_view.py //主页</span><br><span class="line">│  │     user_view.py //用户</span><br><span class="line">│  │     album_view.py //相册</span><br><span class="line">│  │     reminder_view.py//提醒</span><br><span class="line">│  │ </span><br><span class="line">│  ├─static //静态资源，css，js等</span><br><span class="line">│  ├─templates //视图映射的页面</span><br><span class="line">│  │      index.html //主页</span><br><span class="line">│  │      create_event.html //创建事件</span><br><span class="line">│  │      edit_event.html //编辑事件</span><br><span class="line">│  │      event_list.html //查看事件</span><br><span class="line">│  │      login.html //登录</span><br><span class="line">│  │      register.html //注册</span><br><span class="line">│  │      calendar.html</span><br><span class="line">│  │      profile.html</span><br><span class="line">│  │      album.html</span><br><span class="line">│  │      email_history.html</span><br><span class="line">│  │      email_template.html</span><br></pre></td></tr></table></figure><h2 id="模型-数据库的构建"><a href="#模型-数据库的构建" class="headerlink" title="模型-数据库的构建"></a>模型-数据库的构建</h2><p>项目开始项目构建数据库,也是MVC中的模型。数据库的搭建使用了flask-SQLAlchemy的orm框架，使用flask-migrate进行数据库的迁移。</p><p><strong>User.py:</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> db</span><br><span class="line"><span class="keyword">from</span> werkzeug.security <span class="keyword">import</span> generate_password_hash, check_password_hash</span><br><span class="line"><span class="keyword">from</span> flask_login <span class="keyword">import</span> UserMixin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(db.Model, UserMixin):</span><br><span class="line">    __tablename__ = <span class="string">&#x27;users&#x27;</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    email = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>, unique=<span class="literal">True</span>)</span><br><span class="line">    phone = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    password_hash = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>)  <span class="comment"># 添加密码哈希字段</span></span><br><span class="line">    is_admin = db.Column(db.Boolean, default=<span class="literal">False</span>, nullable=<span class="literal">False</span>)  <span class="comment"># 新增 is_admin 字段</span></span><br><span class="line"></span><br><span class="line">    event = db.relationship(<span class="string">&#x27;Event&#x27;</span>, backref=<span class="string">&#x27;user&#x27;</span>, lazy=<span class="string">&#x27;dynamic&#x27;</span>)</span><br><span class="line">    email_history = db.relationship(<span class="string">&#x27;EmailHistory&#x27;</span>, backref=<span class="string">&#x27;user&#x27;</span>, lazy=<span class="string">&#x27;dynamic&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, email, phone, password, is_admin=<span class="literal">False</span></span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.email = email</span><br><span class="line">        self.phone = phone</span><br><span class="line">        self.set_password(password)  <span class="comment"># 在初始化时设置密码哈希值</span></span><br><span class="line">        self.is_admin = is_admin  <span class="comment"># 设置用户是否是管理员</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;User %r&gt;&#x27;</span> % self.name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加密码哈希相关的方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_password</span>(<span class="params">self, password</span>):</span><br><span class="line">        self.password_hash = generate_password_hash(password)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_password</span>(<span class="params">self, password</span>):</span><br><span class="line">        <span class="keyword">return</span> check_password_hash(self.password_hash, password)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 实现 is_active 方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_active</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>  <span class="comment"># 返回 True 表示用户是活动的，可以登录</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>Event.py:</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> db</span><br><span class="line"><span class="keyword">from</span> app.model.User <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.hybrid <span class="keyword">import</span> hybrid_property</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Event</span>(db.Model):</span><br><span class="line">    __tablename__ = <span class="string">&#x27;events&#x27;</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    user_id = db.Column(db.Integer, db.ForeignKey(User.<span class="built_in">id</span>, ondelete=<span class="string">&#x27;CASCADE&#x27;</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    title = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    start_date = db.Column(db.Date, nullable=<span class="literal">False</span>)</span><br><span class="line">    event_time = db.Column(db.Time)</span><br><span class="line">    end_date = db.Column(db.Date)</span><br><span class="line">    location = db.Column(db.String(<span class="number">255</span>))</span><br><span class="line">    description = db.Column(db.String(<span class="number">255</span>))</span><br><span class="line">    repeat = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>, default=<span class="string">&quot;none&quot;</span>)  <span class="comment"># Text field for custom repeat types</span></span><br><span class="line">    reminder_type = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>, default=<span class="string">&quot;none&quot;</span>)</span><br><span class="line">    reminder_time = db.Column(db.Float, nullable=<span class="literal">True</span>, default=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @hybrid_property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">duration</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.end_date - self.start_date</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, user_id, title, start_date, event_time, end_date, location, description, reminder_time,</span></span><br><span class="line"><span class="params">                 repeat, reminder_type</span>):</span><br><span class="line">        self.user_id = user_id</span><br><span class="line">        self.title = title</span><br><span class="line">        self.start_date = start_date</span><br><span class="line">        self.event_time = event_time</span><br><span class="line">        self.end_date = end_date</span><br><span class="line">        self.location = location</span><br><span class="line">        self.description = description</span><br><span class="line">        self.repeat = repeat</span><br><span class="line">        self.reminder_type = reminder_type</span><br><span class="line">        self.reminder_time = reminder_time</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;Event %r&gt;&#x27;</span> % self.title</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>EmailHistory.py:</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding:utf-8  </span></span><br><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> db</span><br><span class="line"><span class="keyword">from</span> app.model.User <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmailHistory</span>(db.Model):</span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    user_id = db.Column(db.Integer, db.ForeignKey(User.<span class="built_in">id</span>, ondelete=<span class="string">&#x27;CASCADE&#x27;</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    title = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    content = db.Column(db.Text, nullable=<span class="literal">False</span>)</span><br><span class="line">    recipients = db.Column(db.String(<span class="number">255</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    sent_at = db.Column(db.DateTime, default=datetime.utcnow, nullable=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, user_id, title, content, recipients</span>):</span><br><span class="line">        self.user_id = user_id</span><br><span class="line">        self.title = title</span><br><span class="line">        self.content = content</span><br><span class="line">        self.recipients = recipients</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>创建好SQLAlchemy后使用flask-Migrate命令初始化数据库，使用数据库迁移可以很好的管理数据库结构的改变而且不会影响数据。</p><h3 id="数据库迁移"><a href="#数据库迁移" class="headerlink" title="数据库迁移"></a><strong>数据库迁移</strong></h3><p>创建迁移存储库：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flask db init</span><br></pre></td></tr></table></figure><p>这会将迁移文件夹添加到应用程序中。此时，你可以发现项目目录多了一个 migrations 的文件夹，下边的 versions 目录下的文件就是生成的数据库迁移文件！</p><p>然后，运行以下命令生成迁移</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flask db migrate -m <span class="string">&quot;initial migration&quot;</span></span><br></pre></td></tr></table></figure><p>做完这两步就完成了第一次的初始迁移操作，我们可以看数据库已经有了我们创建的模型字段！之后，每次在新增和修改完模型数据之后，只需要执行以下两个命令即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flask db migrate -m <span class="string">&quot;description of changes&quot;</span></span><br><span class="line">flask db upgrade</span><br></pre></td></tr></table></figure><p>这些步骤将允许你使用<code>flask_migrate</code>管理数据库模型的变化。请确保按照这些步骤在你的Flask应用中设置并使用<code>flask_migrate</code>，以便维护数据库模型的一致性。</p><p>使用Navicate查看数据模型：</p><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/202312112210753.png" alt="image.png"></p><h2 id="以登录为例创建Web-App"><a href="#以登录为例创建Web-App" class="headerlink" title="以登录为例创建Web App"></a>以登录为例创建Web App</h2><h3 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a><strong>控制器</strong></h3><p>用户管理使用了flask-login管理用户逻辑<br>我们首先编写注册和登录逻辑，创建<code>app/controller/user_controller.py</code> 。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> flash, redirect, url_for, render_template, make_response</span><br><span class="line"><span class="keyword">from</span> flask_login <span class="keyword">import</span> login_user, login_required, logout_user, current_user</span><br><span class="line"><span class="keyword">from</span> app.forms <span class="keyword">import</span> RegisterForm, LoginForm</span><br><span class="line"><span class="keyword">from</span> app.model.User <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> db, login_manager</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    注册新用户。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    该函数处理新用户的注册过程。它验证用户提交的表单数据，</span></span><br><span class="line"><span class="string">    检查用户是否已存在，在数据库中创建新用户，并将用户重定向到登录页面</span></span><br><span class="line"><span class="string">    注册成功后。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        如果表单数据有效并且用户注册成功，则将用户重定向到登录页面。</span></span><br><span class="line"><span class="string">        否则，它会呈现带有注册表单的 register.html 模板。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    form = RegisterForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        <span class="comment"># 获取用户提交的数据</span></span><br><span class="line">        name = form.name.data</span><br><span class="line">        email = form.email.data</span><br><span class="line">        phone = form.phone.data</span><br><span class="line">        password = form.password.data</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查用户是否已存在</span></span><br><span class="line">        existing_user = User.query.filter_by(email=email).first()</span><br><span class="line">        <span class="keyword">if</span> existing_user:</span><br><span class="line">            flash(<span class="string">&#x27;该邮箱地址已被注册&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;user.register&#x27;</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 创建新用户</span></span><br><span class="line">        new_user = User(name=name, email=email, phone=phone, password=password)</span><br><span class="line">        db.session.add(new_user)</span><br><span class="line">        db.session.commit()</span><br><span class="line"></span><br><span class="line">        flash(<span class="string">&#x27;注册成功，请登录&#x27;</span>, <span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;user.login&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, form=form)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    用户登录函数</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    如果用户已登录，则重定向到受保护的页面。</span></span><br><span class="line"><span class="string">    如果用户提交了有效的登录表单，则验证用户凭据并将用户标记为已登录。</span></span><br><span class="line"><span class="string">    如果用户验证失败，则显示错误消息。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    return: 渲染登录页面或重定向到受保护的页面</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> current_user.is_authenticated:</span><br><span class="line">        <span class="comment"># 如果用户已登录，重定向到受保护的页面</span></span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;event.show_event&#x27;</span>))</span><br><span class="line">    form = LoginForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        email = form.email.data  <span class="comment"># 修改为使用邮箱作为登录凭据</span></span><br><span class="line">        password = form.password.data</span><br><span class="line">        user = User.query.filter_by(email=email).first()</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">and</span> user.check_password(password):</span><br><span class="line">            <span class="comment"># 用户验证成功，将用户标记为已登录</span></span><br><span class="line">            <span class="comment"># 可以使用 Flask-Login 或自己的会话管理逻辑来处理登录状态</span></span><br><span class="line">            login_user(user, remember=form.remember)</span><br><span class="line">            <span class="comment"># return redirect(url_for(&#x27;event.show_event&#x27;))  # 跳转到用户仪表板或其他受保护的页面</span></span><br><span class="line">            <span class="comment"># 设置cookie</span></span><br><span class="line">            response = make_response(redirect(url_for(<span class="string">&#x27;event.show_event&#x27;</span>)))</span><br><span class="line">            response.set_cookie(<span class="string">&#x27;user_id&#x27;</span>, <span class="built_in">str</span>(user.<span class="built_in">id</span>))  <span class="comment"># 存储用户ID在cookie中</span></span><br><span class="line">            flash(<span class="string">&#x27;登录成功&#x27;</span>, <span class="string">&#x27;success&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flash(<span class="string">&#x27;登录失败，请检查邮箱或密码&#x27;</span>, <span class="string">&#x27;error&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, form=form)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">profile</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    用户个人信息页面</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    name = current_user.name</span><br><span class="line">    email = current_user.email</span><br><span class="line">    phone = current_user.phone</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;profile.html&#x27;</span>, name=name, email=email, phone=phone)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    logout_user()  <span class="comment"># 使用 Flask-Login 注销用户</span></span><br><span class="line">    flash(<span class="string">&#x27;成功注销&#x27;</span>, <span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;user.login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_manager.user_loader</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_user</span>(<span class="params">user_id</span>):</span><br><span class="line">    <span class="comment"># 使用用户 ID 查询用户对象</span></span><br><span class="line">    <span class="keyword">return</span> User.query.get(<span class="built_in">int</span>(user_id))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>创建表单验证:</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># forms.py  </span></span><br><span class="line"><span class="keyword">from</span> flask_wtf <span class="keyword">import</span> FlaskForm  </span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> StringField, PasswordField, validators, SubmitField, ValidationError, DateField, TimeField  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RegisterForm</span>(<span class="title class_ inherited__">FlaskForm</span>):  </span><br><span class="line">name = StringField(<span class="string">&#x27;用户名&#x27;</span>, [validators.DataRequired(<span class="string">&quot;用户名不能为空&quot;</span>)])  </span><br><span class="line">email = StringField(<span class="string">&#x27;邮箱&#x27;</span>, [validators.DataRequired(<span class="string">&quot;邮箱不能为空&quot;</span>), validators.Email(<span class="string">&quot;无效的邮箱地址&quot;</span>)])  </span><br><span class="line">phone = StringField(<span class="string">&#x27;电话&#x27;</span>)  </span><br><span class="line">password = PasswordField(<span class="string">&#x27;密码&#x27;</span>, [  </span><br><span class="line">validators.DataRequired(<span class="string">&quot;密码不能为空&quot;</span>),  </span><br><span class="line">validators.Length(<span class="built_in">min</span>=<span class="number">8</span>, message=<span class="string">&quot;密码长度至少 8 个字符&quot;</span>)  </span><br><span class="line">])  </span><br><span class="line">confirm_password = PasswordField(<span class="string">&#x27;确认密码&#x27;</span>, [  </span><br><span class="line">validators.DataRequired(<span class="string">&quot;请再次输入密码&quot;</span>),  </span><br><span class="line">validators.EqualTo(<span class="string">&#x27;password&#x27;</span>, message=<span class="string">&#x27;两次密码不匹配&#x27;</span>)  </span><br><span class="line">])  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginForm</span>(<span class="title class_ inherited__">FlaskForm</span>):  </span><br><span class="line">email = StringField(<span class="string">&#x27;邮箱&#x27;</span>, [validators.DataRequired(<span class="string">&quot;邮箱不能为空&quot;</span>), validators.Email(<span class="string">&quot;无效的邮箱地址&quot;</span>)])  </span><br><span class="line">password = PasswordField(<span class="string">&#x27;密码&#x27;</span>, [validators.DataRequired(<span class="string">&quot;密码不能为空&quot;</span>)])  </span><br><span class="line">remember = StringField(<span class="string">&#x27;记住我&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a><strong>视图</strong></h3><p>项目使用flask Blueprint(蓝图)来管理路由,创建<code>app/views/user_view.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># user_view.py  </span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint  </span><br><span class="line"><span class="keyword">from</span> app.controller <span class="keyword">import</span> user_controller  </span><br><span class="line">  </span><br><span class="line">user_blueprint = Blueprint(<span class="string">&#x27;user&#x27;</span>, __name__)  </span><br><span class="line">  </span><br><span class="line">user_blueprint.route(<span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>])(user_controller.register)  </span><br><span class="line">user_blueprint.route(<span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>])(user_controller.login)  </span><br><span class="line">user_blueprint.route(<span class="string">&#x27;/logout&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>])(user_controller.logout)  </span><br><span class="line">user_blueprint.route(<span class="string">&#x27;/profile&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>])(user_controller.profile)</span><br></pre></td></tr></table></figure><h3 id="将参数通过jinja2传递到前端"><a href="#将参数通过jinja2传递到前端" class="headerlink" title="将参数通过jinja2传递到前端"></a>将参数通过jinja2传递到前端</h3><p><strong>注册页面:</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">title</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../static/css/register-login.css&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../static/images/robot.png&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/x-icon&quot;</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;cent-box register-box&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;cent-box-header&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;main-title hide&quot;</span>&gt;</span>Pepper机器人<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;sub-title&quot;</span>&gt;</span>日程管理系统<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;cont-main clearfix&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index-tab&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index-slide-nav&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;user.login&#x27;) &#125;&#125;&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;user.register&#x27;) &#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;active&quot;</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;slide-bar slide-bar1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span>  </span><br><span class="line">&#123;&#123; form.hidden_tag() &#125;&#125;  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login form&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;group&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;group-ipt name&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span>  </span><br><span class="line">&#123;% if form.name.data is not none %&#125;  </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; form.name.data &#125;&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入您的用户名&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line">&#123;% else %&#125;  </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入您的用户名&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line">&#123;% endif %&#125;  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;group-ipt email&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span>  </span><br><span class="line">&#123;% if form.email.data is not none %&#125;  </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">id</span>=<span class="string">&quot;email&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; form.email.data &#125;&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入您的邮箱&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line">&#123;% else %&#125;  </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">id</span>=<span class="string">&quot;email&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入您的邮箱&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line">&#123;% endif %&#125;  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;group-ipt phone&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;phone&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span>  </span><br><span class="line">&#123;% if form.phone.data is not none %&#125;  </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">id</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; form.phone.data &#125;&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入您的电话&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line">&#123;% else %&#125;  </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">id</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入您的电话&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line">&#123;% endif %&#125;  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;group-ipt password&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入密码&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;group-ipt confirm_password&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;confirm_password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;confirm_password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;confirm_password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;确认密码&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;register-btn&quot;</span> <span class="attr">id</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;注册&quot;</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;../static/js/particles.js&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;../static/js/background.js&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;../static/js/jquery.min.js&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;../static/js/layer/layer.js&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;../static/js/index.js&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>效果图:<br><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/202312112239677.png" alt="image.png"></p><p><strong>登录页面:</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;css/register-login.css&#x27;) &#125;&#125;&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;images/robot.png&#x27;) &#125;&#125;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/x-icon&quot;</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;cent-box&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;cent-box-header&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;main-title hide&quot;</span>&gt;</span>Pepper机器人<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;sub-title&quot;</span>&gt;</span>日程管理系统<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;cont-main clearfix&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index-tab&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;index-slide-nav&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;user.login&#x27;) &#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;active&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;user.register&#x27;) &#125;&#125;&quot;</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;slide-bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span>  </span><br><span class="line">&#123;&#123; form.hidden_tag() &#125;&#125;  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login form&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;group&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;group-ipt email&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span>  </span><br><span class="line">&#123;% if form.email.data is not none %&#125;  </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">id</span>=<span class="string">&quot;email&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; form.email.data &#125;&#125;&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入您的邮箱&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line">&#123;% else %&#125;  </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">id</span>=<span class="string">&quot;email&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入您的邮箱&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line">&#123;% endif %&#125;  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;group-ipt password&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入您的登录密码&quot;</span> <span class="attr">required</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;login-btn register-btn&quot;</span> <span class="attr">id</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;remember clearfix&quot;</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;remember-me&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;remember&quot;</span>&gt;</span> 记住我<span class="tag">&lt;/<span class="name">label</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;../static/js/particles.js&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;../static/js/background.js&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;../static/js/jquery.min.js&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;../static/js/layer/layer.js&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;../static/js/index.js&#x27;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>效果图:</p><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/202312112239068.png" alt="image.png"></p><h3 id="配置config-py"><a href="#配置config-py" class="headerlink" title="配置config.py"></a>配置config.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 调试模式是否开启  </span></span><br><span class="line">DEBUG = <span class="literal">True</span>  </span><br><span class="line"><span class="comment"># 是否追踪对象的修改。  </span></span><br><span class="line">SQLALCHEMY_TRACK_MODIFICATIONS = <span class="literal">True</span>  </span><br><span class="line"><span class="comment"># 查询时显示原始SQL语句  </span></span><br><span class="line">SQLALCHEMY_ECHO = <span class="literal">False</span>  </span><br><span class="line"><span class="comment"># session必须要设置key  </span></span><br><span class="line">SECRET_KEY = <span class="string">&#x27;c798ee1f5fd894f6e0ba9fc0d16b8b22&#x27;</span>  </span><br><span class="line"><span class="comment"># mysql数据库连接信息  </span></span><br><span class="line">DATABASE = <span class="string">&#x27;schedule&#x27;</span>  </span><br><span class="line">SQLALCHEMY_DATABASE_URI = <span class="string">&quot;mysql+pymysql://[user]:[password]@localhost/&quot;</span> + DATABASE</span><br></pre></td></tr></table></figure><h3 id="使用工厂函数初始化"><a href="#使用工厂函数初始化" class="headerlink" title="使用工厂函数初始化"></a>使用工厂函数初始化</h3><p><code>app/_init_.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask  </span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy  </span><br><span class="line"><span class="keyword">from</span> flask_login <span class="keyword">import</span> LoginManager  </span><br><span class="line"><span class="keyword">from</span> flask_migrate <span class="keyword">import</span> Migrate  </span><br><span class="line"><span class="keyword">from</span> flask_restful <span class="keyword">import</span> Api  </span><br><span class="line"><span class="keyword">from</span> flask_admin <span class="keyword">import</span> Admin  </span><br><span class="line"><span class="keyword">from</span> flask_mail <span class="keyword">import</span> Mail  </span><br><span class="line"><span class="keyword">from</span> flask_uploads <span class="keyword">import</span> configure_uploads  </span><br><span class="line"><span class="keyword">import</span> logging  </span><br><span class="line"><span class="keyword">from</span> logging.handlers <span class="keyword">import</span> RotatingFileHandler  </span><br><span class="line"><span class="keyword">from</span> flask_apscheduler <span class="keyword">import</span> APScheduler  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 创建Flask应用实例  </span></span><br><span class="line">db = SQLAlchemy() <span class="comment"># 数据库实例  </span></span><br><span class="line">login_manager = LoginManager() <span class="comment"># 登录管理实例  </span></span><br><span class="line">migrate = Migrate() <span class="comment"># 数据库迁移实例   </span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_app</span>() -&gt; Flask:  </span><br><span class="line"><span class="string">&quot;&quot;&quot;创建Flask应用实例并进行初始化设置。  </span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">Returns:  </span></span><br><span class="line"><span class="string">Flask: 初始化设置后的Flask应用实例。  </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>  </span><br><span class="line">app = Flask(__name__)  </span><br><span class="line">app.config.from_object(<span class="string">&#x27;app.config&#x27;</span>)  </span><br><span class="line">app.config.from_envvar(<span class="string">&#x27;FLASKR_CONFIGS&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line">configure_logging(app) <span class="comment"># 添加日志配置  </span></span><br><span class="line">initialize_extensions(app) <span class="comment"># 初始化  </span></span><br><span class="line">register_blueprints(app) <span class="comment"># 注册蓝图  </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> app  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initialize_extensions</span>(<span class="params">app: Flask</span>) -&gt; <span class="literal">None</span>:  </span><br><span class="line"><span class="string">&quot;&quot;&quot;初始化扩展，包括数据库、登录管理、数据库迁移、邮件和文件上传。  </span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">Args:  </span></span><br><span class="line"><span class="string">app (Flask): Flask应用实例。  </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>  </span><br><span class="line">db.init_app(app)  </span><br><span class="line">migrate.init_app(app, db)  </span><br><span class="line">login_manager.init_app(app)  </span><br><span class="line">login_manager.login_view = <span class="string">&#x27;user.login&#x27;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register_blueprints</span>(<span class="params">app: Flask</span>) -&gt; <span class="literal">None</span>:  </span><br><span class="line"><span class="string">&quot;&quot;&quot;注册蓝图，包括主页、用户、事件和提醒蓝图。  </span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">Args:  </span></span><br><span class="line"><span class="string">app (Flask): Flask应用实例。  </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>   </span><br><span class="line"><span class="keyword">from</span> app.views.user_view <span class="keyword">import</span> user_blueprint  </span><br><span class="line"></span><br><span class="line">app.register_blueprint(user_blueprint, url_prefix=<span class="string">&#x27;/user&#x27;</span>)  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">configure_logging</span>(<span class="params">app: Flask</span>) -&gt; <span class="literal">None</span>:  </span><br><span class="line"><span class="string">&quot;&quot;&quot;配置应用程序日志。  </span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">Args:  </span></span><br><span class="line"><span class="string">app (Flask): Flask应用实例。  </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>  </span><br><span class="line">log_file_path = <span class="string">&#x27;app.log&#x27;</span>  </span><br><span class="line">log_handler = RotatingFileHandler(log_file_path, maxBytes=<span class="number">10240</span>, backupCount=<span class="number">10</span>)  </span><br><span class="line">log_handler.setFormatter(logging.Formatter(  </span><br><span class="line"><span class="string">&#x27;%(asctime)s %(levelname)s: %(message)s &#x27;</span>  </span><br><span class="line"><span class="string">&#x27;[in %(pathname)s:%(lineno)d]&#x27;</span>  </span><br><span class="line">))  </span><br><span class="line">log_handler.setLevel(logging.INFO)  </span><br><span class="line">app.logger.addHandler(log_handler)  </span><br><span class="line">  </span><br></pre></td></tr></table></figure><h3 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h3><p><code>app/runserver.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> create_app  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">app = create_app()  </span><br><span class="line">app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pepper </tag>
            
            <tag> python </tag>
            
            <tag> choregraphe </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【Pepper机器人管家（一）】项目构建</title>
      <link href="/2023/12/11/%E3%80%90Pepper%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%AE%A1%E5%AE%B6%EF%BC%88%E4%B8%80%EF%BC%89%E3%80%91%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA/"/>
      <url>/2023/12/11/%E3%80%90Pepper%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%AE%A1%E5%AE%B6%EF%BC%88%E4%B8%80%EF%BC%89%E3%80%91%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="项目概述"><a href="#项目概述" class="headerlink" title="项目概述"></a>项目概述</h1><p>基于软银的pepper机器人，使用可视化低代码SDK软件choregraphe和web开发工具链开发一个机器人管家。考虑到的功能有提醒按时用药，健康疑难解答，康复训练教程，闹钟，跌倒检测功能(内置电话功能与邮件功能)，听歌，读报，跳舞……。</p><h1 id="项目架构"><a href="#项目架构" class="headerlink" title="项目架构"></a>项目架构</h1><p>目前考虑的的功能的实现主要分成两部分，一个是基于choregraphe的机器人模块的开发，一个是基于web开发的网站。将这两部分结合后构成一个机器人管家。<br><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/202312101951636.png" alt="image.png"></p><h2 id="Choregraphe"><a href="#Choregraphe" class="headerlink" title="Choregraphe"></a>Choregraphe</h2><p><strong>choregraph主要承担系统的主控并实现提醒、跳舞、交流等功能</strong><br>choregraphe是一个低代码的Pepper SDK，内置很多可拖拽的功能盒子，能完成项目的绝大部分需求。其中还有python script盒子能实现一些简单的python脚本，可惜python的版本只有python 2.7，而且很多库没有内置，在是开发的一大困难之一。</p><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/202312101957354.png" alt="image.png"></p><p>第二大难点是代码的调试和程序的稳定性很差，低代码的坏处就是自由度太低，而且网上的教程太少，整个项目开发只需要一份官方文档，官方文档虽然很多地方不齐全但也是比较完整。<a href="http://doc.aldebaran.com/2-4/index_dev_guide.html">官方文档</a></p><h2 id="Web开发"><a href="#Web开发" class="headerlink" title="Web开发"></a>Web开发</h2><p><strong>Web模块主要承担日程的设置、信息的推送、用户管理等功能</strong><br>web开发选用的技术栈为：flask+MySQL+jinja2的前后端不分离开发流程，页面使用原生js+html+css。没有使用前端框架并使用前后端不分离主要是机器人的平板内置的浏览器版本太低，无法兼容大部分的“重型”js框架，将页面资源在后端渲染或许是比较好的方法。工具链使用的是Pycharm+navicat+vscode，部署使用了nginx+gunicorn，部署服务器为阿里云的轻量应用服务器2核4G：Ubuntu。</p><h3 id="后端："><a href="#后端：" class="headerlink" title="后端："></a><strong>后端：</strong></h3><p>后端使用了MVC架构，用蓝图管理路由，并且创建了一些api供机器人调用，机器人与服务器主要同这些api进行通讯。</p><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/202312121955641.png" alt="image.png"></p><h4 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a><strong>数据库</strong></h4><p>数据库的搭建使用了MySQL+flask-SQLAlchemy的orm框架。数据库涉及到用户的的注册和登录、用户的的日程CRUD、用户邮件的历史的保存和删除。</p><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/202312102017330.png" alt="image.png"></p><h3 id="前端"><a href="#前端" class="headerlink" title="前端:"></a><strong>前端:</strong></h3><p>前端是二次开发的原生js的页面</p><p><strong>主页:</strong><br><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/202312102038614.png" alt="image.png"></p><p><strong>日程管理:</strong><br><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/202312102039763.png" alt="image.png"></p><p>完整的项目代码参考GitHub: <a href="https://github.com/Lucawell/flaskSchedule-pepper-MVC">https://github.com/Lucawell/flaskSchedule-pepper-MVC</a></p>]]></content>
      
      
      <categories>
          
          <category> 项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pepper </tag>
            
            <tag> python </tag>
            
            <tag> choregraphe </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git基本使用</title>
      <link href="/2023/08/08/Git%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"/>
      <url>/2023/08/08/Git%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><p>检查是否安装git：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git</span><br><span class="line">The program <span class="string">&#x27;git&#x27;</span> is currently not installed. You can install it by typing:</span><br><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure><p>安装git:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure><p><strong>通过源码安装</strong><br>先从Git官网下载源码，然后解压，依次输入：<code>./config</code>，<code>make</code>，<code>sudo make install</code>这几个命令安装就好了。</p><h2 id="Mac-OS-X"><a href="#Mac-OS-X" class="headerlink" title="Mac OS X"></a>Mac OS X</h2><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>安装homebrew，然后通过homebrew安装Git，具体方法请参考homebrew的文档：<a href="http://brew.sh/">http://brew.sh/</a>。</p><h3 id="方法二-推荐"><a href="#方法二-推荐" class="headerlink" title="方法二(推荐)"></a>方法二(推荐)</h3><p>直接从AppStore安装Xcode，Xcode集成了Git，不过默认没有安装，你需要运行Xcode，选择菜单“Xcode”-&gt;“Preferences”，在弹出窗口中找到“Downloads”，选择“Command Line Tools”，点“Install”就可以完成安装了。</p><h2 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h2><p>Git官网直接<a href="https://git-scm.com/downloads">下载安装程序</a>，然后按默认选项安装即可。</p><h3 id="设置用户名和邮箱"><a href="#设置用户名和邮箱" class="headerlink" title="设置用户名和邮箱"></a>设置用户名和邮箱</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git config --global user.name <span class="string">&quot;用户名&quot;</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git config --global user.email <span class="string">&quot;邮箱&quot;</span></span></span><br></pre></td></tr></table></figure><h1 id="本地"><a href="#本地" class="headerlink" title="本地"></a>本地</h1><h2 id="创建版本库"><a href="#创建版本库" class="headerlink" title="创建版本库"></a>创建版本库</h2><p>右键项目的根目录,点击”Git Bash Here”</p><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/20230602224101.png" alt="image.png"></p><p>输入命令在当前目录创建版本库:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init </span><br></pre></td></tr></table></figure><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/20230602224619.png" alt="image.png"></p><p>.git 文件为隐藏文件打开显示隐藏文件即可,不推荐对.<code>git</code>文件进行修改</p><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/20230602224745.png" alt="image.png"></p><h3 id="查看仓库状态"><a href="#查看仓库状态" class="headerlink" title="查看仓库状态"></a>查看仓库状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure><h2 id="基本工作流程"><a href="#基本工作流程" class="headerlink" title="基本工作流程"></a>基本工作流程</h2><ul><li>工作区：就是你在电脑里能看到的目录。</li><li>暂存区：英文叫 stage 或 index。一般存放在 .git 目录下的 index 文件（.git&#x2F;index）中，所以我们把暂存区有时也叫作索引（index）。</li><li>版本库：工作区有一个隐藏目录 .git，这个不算工作区，而是 Git 的版本库。</li></ul><p>下面这个图展示了工作区、版本库中的暂存区和版本库之间的关系：</p><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/1352126739_7909.jpg"></p><h3 id="版本穿梭"><a href="#版本穿梭" class="headerlink" title="版本穿梭"></a>版本穿梭</h3><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/20230602225450.png" alt="image.png"></p><ul><li>workspace：工作区</li><li>staging area：暂存区&#x2F;缓存区</li><li>local repository：版本库或本地仓库</li><li>remote repository：远程仓库</li></ul><h4 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h4><table><thead><tr><th>git init</th><th>初始化本地库</th></tr></thead><tbody><tr><td>git status</td><td>查看本地库状态</td></tr><tr><td>git add &lt;文件名&gt;</td><td>添加到暂存区</td></tr><tr><td>git commit -m”日志信息” &lt;文件名&gt;</td><td>提交到本地仓库</td></tr><tr><td>git reflog</td><td>查看历史记录</td></tr><tr><td>git reset -hard 版本号</td><td>版本穿梭</td></tr></tbody></table><h3 id="分支管理"><a href="#分支管理" class="headerlink" title="分支管理"></a>分支管理</h3><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/20230602231000.png" alt="image.png"></p><table><thead><tr><th>git branch (分支名)</th><th>创建分支</th></tr></thead><tbody><tr><td>git checkout&#x2F;switch (分支名)</td><td>切换分支</td></tr><tr><td>git merge (分支名)</td><td>合并分支(指定分支合并到当前分支)</td></tr></tbody></table><h4 id="解决冲突"><a href="#解决冲突" class="headerlink" title="解决冲突"></a>解决冲突</h4><p>合并分支时时常会产生冲突,此时将无法完成合并:</p><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/20230602231739.png" alt="image.png"></p><p>产生冲突后文件会出现以下的符号:</p><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/20230602231935.png" alt="image.png"></p><p>删除符号和不需要的信息后保存文件并重新提交</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git add &lt;文件名&gt;</span><br><span class="line">git commit -m<span class="string">&quot;修改信息&quot;</span></span><br></pre></td></tr></table></figure><p>此时commit后不需要文件名</p>]]></content>
      
      
      <categories>
          
          <category> 教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windows 宿主机ssh连接VMware虚拟机</title>
      <link href="/2023/08/08/windows%20%E5%AE%BF%E4%B8%BB%E6%9C%BAssh%E8%BF%9E%E6%8E%A5VMware%E8%99%9A%E6%8B%9F%E6%9C%BA/"/>
      <url>/2023/08/08/windows%20%E5%AE%BF%E4%B8%BB%E6%9C%BAssh%E8%BF%9E%E6%8E%A5VMware%E8%99%9A%E6%8B%9F%E6%9C%BA/</url>
      
        <content type="html"><![CDATA[<h2 id="网络适配器"><a href="#网络适配器" class="headerlink" title="网络适配器"></a>网络适配器</h2><p>网络连接选择NAT模式</p><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/20230808212908.png" alt="image.png"></p><h2 id="获取宿主机和虚拟机的ip地址"><a href="#获取宿主机和虚拟机的ip地址" class="headerlink" title="获取宿主机和虚拟机的ip地址"></a>获取宿主机和虚拟机的ip地址</h2><h3 id="宿主机："><a href="#宿主机：" class="headerlink" title="宿主机："></a>宿主机：</h3><p>在cmd输入命令：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ipconfig</span></span><br></pre></td></tr></table></figure><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/20230808213507.png" alt="image.png"></p><p>此处物理机正在使用的无线网络，所以IP地址是10.151.*** . ***</p><h3 id="虚拟机："><a href="#虚拟机：" class="headerlink" title="虚拟机："></a>虚拟机：</h3><p>在虚拟机终端输入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/20230808213920.png" alt="image.png"></p><p>此处虚拟机IP地址为：192.168.131.130</p><p><strong>注意：</strong><code>ifconfig</code>如果提示不存在按提示安装即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install net-tools <span class="comment">#centos</span></span><br><span class="line">apt install net-tools <span class="comment">#Debian</span></span><br></pre></td></tr></table></figure><h2 id="虚拟机和宿主机IP映射"><a href="#虚拟机和宿主机IP映射" class="headerlink" title="虚拟机和宿主机IP映射"></a>虚拟机和宿主机IP映射</h2><p>编辑–&gt;虚拟网络编辑器:</p><p>选择VMnet8,更改设置</p><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/20230808214747.png" alt="image.png"></p><p>选择 VMnet8，点击 NAT 设置</p><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/20230808215026.png" alt="image.png"></p><p>点击添加</p><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/20230808215202.png" alt="image.png"></p><p>将虚拟机的IP地址和端口号填入(端口默认22)</p><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/20230808215322.png" alt="image.png"></p><p>确定保存</p><h2 id="在虚拟机安装ssh服务"><a href="#在虚拟机安装ssh服务" class="headerlink" title="在虚拟机安装ssh服务"></a>在虚拟机安装ssh服务</h2><p>openssh-client：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssh-client</span><br></pre></td></tr></table></figure><p>openssh-server：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssh-server</span><br></pre></td></tr></table></figure><p> 启动 ssh-server：<br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/ssh restart</span><br></pre></td></tr></table></figure></p><p>确认 ssh-server 工作正常：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -tpl <span class="comment"># 看到 ssh 表示工作正常</span></span><br></pre></td></tr></table></figure><h2 id="设置服务器允许root用户ssh登录"><a href="#设置服务器允许root用户ssh登录" class="headerlink" title="设置服务器允许root用户ssh登录"></a>设置服务器允许root用户ssh登录</h2><p>完成以上步骤之后仍有可能连接不上服务器,这是因为有些系统不允许ssh使用root用户登录</p><h3 id="修改-etc-ssh-sshd-config文件"><a href="#修改-etc-ssh-sshd-config文件" class="headerlink" title="修改&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件"></a>修改&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/etc/</span>ssh/sshd_config</span><br></pre></td></tr></table></figure><p>设置以下两项为yes</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PermitRootLogin yes</span><br><span class="line">PasswordAuthentication yes</span><br></pre></td></tr></table></figure><p>完成后重启服务器或者ssh即可</p>]]></content>
      
      
      <categories>
          
          <category> 教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 虚拟机 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式简介</title>
      <link href="/2023/05/08/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%AE%80%E4%BB%8B/"/>
      <url>/2023/05/08/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%AE%80%E4%BB%8B/</url>
      
        <content type="html"><![CDATA[<p>根据设计模式的参考书 <strong>Design Patterns - Elements of Reusable Object-Oriented Software（中文译名：设计模式 - 可复用的面向对象软件元素）</strong> 中所提到的，总共有 23 种设计模式。这些模式可以分为三大类：创建型模式（Creational Patterns）、结构型模式（Structural Patterns）、行为型模式（Behavioral Patterns）。当然，我们还会讨论另一类设计模式：J2EE 设计模式。</p><span id="more"></span><h2 id="核心需求"><a href="#核心需求" class="headerlink" title="核心需求"></a>核心需求</h2><p>代码应该：<strong>高内聚</strong>、<strong>松耦合</strong></p><ul><li>可维护</li><li>可复用</li><li>可扩展</li><li>灵活性好</li></ul><h3 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h3><ul><li>封装</li><li>继承</li><li>多态</li></ul><h2 id="UML类图"><a href="#UML类图" class="headerlink" title="UML类图"></a>UML类图</h2><p><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/20230429160539.png" alt="image.png"></p><p><strong>‘+’ 表 示 public，‘-’表示private，‘#’表示protected</strong></p><h2 id="设计模式的类型"><a href="#设计模式的类型" class="headerlink" title="设计模式的类型"></a>设计模式的类型</h2><p>根据设计模式的参考书 <strong>Design Patterns - Elements of Reusable Object-Oriented Software（中文译名：设计模式 - 可复用的面向对象软件元素）</strong> 中所提到的，总共有 23 种设计模式。这些模式可以分为三大类：创建型模式（Creational Patterns）、结构型模式（Structural Patterns）、行为型模式（Behavioral Patterns）。当然，我们还会讨论另一类设计模式：J2EE 设计模式。</p><table><tbody><tr><th>序号</th><th>模式 &amp; 描述</th><th>包括</th></tr><tr><td>1</td><td><b>创建型模式</b><br>这些设计模式提供了一种在创建对象的同时隐藏创建逻辑的方式，而不是使用 new 运算符直接实例化对象。这使得程序在判断针对某个给定实例需要创建哪些对象时更加灵活。</td><td><ul><li>工厂模式（Factory Pattern）</li><li>抽象工厂模式（Abstract Factory Pattern）</li><li>单例模式（Singleton Pattern）</li><li>建造者模式（Builder Pattern）</li><li>原型模式（Prototype Pattern）</li></ul></td></tr><tr><td>2</td><td><b>结构型模式</b><br>这些设计模式关注类和对象的组合。继承的概念被用来组合接口和定义组合对象获得新功能的方式。</td><td><ul><li>适配器模式（Adapter Pattern）</li><li>桥接模式（Bridge Pattern）</li><li>过滤器模式（Filter、Criteria Pattern）</li><li>组合模式（Composite Pattern）</li><li>装饰器模式（Decorator Pattern）</li><li>外观模式（Facade Pattern）</li><li>享元模式（Flyweight Pattern）</li><li>代理模式（Proxy Pattern）</li></ul></td></tr><tr><td>3</td><td><b>行为型模式</b><br>这些设计模式特别关注对象之间的通信。</td><td><ul><li>责任链模式（Chain of Responsibility Pattern）</li><li>命令模式（Command Pattern）</li><li>解释器模式（Interpreter Pattern）</li><li>迭代器模式（Iterator Pattern）</li><li>中介者模式（Mediator Pattern）</li><li>备忘录模式（Memento Pattern）</li><li>观察者模式（Observer Pattern）</li><li>状态模式（State Pattern）</li><li>空对象模式（Null Object Pattern）</li><li>策略模式（Strategy Pattern）</li><li>模板模式（Template Pattern）</li><li>访问者模式（Visitor Pattern）</li></ul></td></tr><tr><td>4</td><td><b>J2EE 模式</b><br>这些设计模式特别关注表示层。这些模式是由 Sun Java Center 鉴定的。</td><td><ul><li>MVC 模式（MVC Pattern）</li><li>业务代表模式（Business Delegate Pattern）</li><li>组合实体模式（Composite Entity Pattern）</li><li>数据访问对象模式（Data Access Object Pattern）</li><li>前端控制器模式（Front Controller Pattern）</li><li>拦截过滤器模式（Intercepting Filter Pattern）</li><li>服务定位器模式（Service Locator Pattern）</li><li>传输对象模式（Transfer Object Pattern）</li></ul></td></tr></tbody></table><p>下面用一个图片来整体描述一下设计模式之间的关系：<br><img src="https://img-1313049298.cos.ap-shanghai.myqcloud.com/note-img/the-relationship-between-design-patterns.jpg"></p><h2 id="设计模式的六大原则"><a href="#设计模式的六大原则" class="headerlink" title="设计模式的六大原则"></a>设计模式的六大原则</h2><p><strong>1、开闭原则（Open Close Principle）</strong></p><p>开闭原则的意思是：<strong>对扩展开放，对修改关闭</strong>。在程序需要进行拓展的时候，不能去修改原有的代码，实现一个热插拔的效果。简言之，是为了使程序的扩展性好，易于维护和升级。想要达到这样的效果，我们需要使用接口和抽象类，后面的具体设计中我们会提到这点。</p><p><strong>2、里氏代换原则（Liskov Substitution Principle）</strong></p><p>里氏代换原则是面向对象设计的基本原则之一。 里氏代换原则中说，任何基类可以出现的地方，子类一定可以出现。LSP 是继承复用的基石，只有当派生类可以替换掉基类，且软件单位的功能不受到影响时，基类才能真正被复用，而派生类也能够在基类的基础上增加新的行为。里氏代换原则是对开闭原则的补充。实现开闭原则的关键步骤就是抽象化，而基类与子类的继承关系就是抽象化的具体实现，所以里氏代换原则是对实现抽象化的具体步骤的规范。</p><p><strong>3、依赖倒转原则（Dependence Inversion Principle）</strong></p><p>这个原则是开闭原则的基础，具体内容：针对接口编程，依赖于抽象而不依赖于具体。</p><p><strong>4、接口隔离原则（Interface Segregation Principle）</strong></p><p>这个原则的意思是：使用多个隔离的接口，比使用单个接口要好。它还有另外一个意思是：降低类之间的耦合度。由此可见，其实设计模式就是从大型软件架构出发、便于升级和维护的软件设计思想，它强调降低依赖，降低耦合。</p><p><strong>5、迪米特法则，又称最少知道原则（Demeter Principle）</strong></p><p>最少知道原则是指：一个实体应当尽量少地与其他实体之间发生相互作用，使得系统功能模块相对独立。</p><p><strong>6、合成复用原则（Composite Reuse Principle）</strong></p><p>合成复用原则是指：尽量使用合成 &#x2F; 聚合的方式，而不是使用继承。</p>]]></content>
      
      
      <categories>
          
          <category> 编程范式 </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
